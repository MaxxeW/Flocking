/*! Flocking 0.2.0-dev, Copyright 2015 Colin Clark | flockingjs.org */

var fluid=fluid||require("infusion"),flock=fluid.registerNamespace("flock");!function(){"use strict";var a=fluid.registerNamespace("jQuery");flock.isUGen=function(a){return a&&a.tags&&a.tags.indexOf("flock.ugen")>-1},flock.aliasUGen=function(b,c,d,e){var f=flock.get(b);flock.set(f,c,function(b,c,d){return d=a.extend(!0,{},e,d),f(b,c,d)}),fluid.defaults(b+"."+c,d)},flock.aliasUGens=function(a,b){var c,d;for(c in b)d=b[c],flock.aliasUGen(a,c,{inputs:d.inputDefaults},d.options)},flock.krMul=function(a,b,c){var d,e=c.output[0];for(d=0;a>d;d++)b[d]=b[d]*e},flock.mul=function(a,b,c){var d,e=c.output;for(d=0;a>d;d++)b[d]=b[d]*e[d]},flock.krAdd=function(a,b,c,d){var e,f=d.output[0];for(e=0;a>e;e++)b[e]=b[e]+f},flock.add=function(a,b,c,d){var e,f=d.output;for(e=0;a>e;e++)b[e]=b[e]+f[e]},flock.krMulAdd=function(a,b,c,d){var e,f=c.output[0],g=d.output;for(e=0;a>e;e++)b[e]=b[e]*f+g[e]},flock.mulKrAdd=function(a,b,c,d){var e,f=c.output,g=d.output[0];for(e=0;a>e;e++)b[e]=b[e]*f[e]+g},flock.krMulKrAdd=function(a,b,c,d){var e,f=c.output[0],g=d.output[0];for(e=0;a>e;e++)b[e]=b[e]*f+g},flock.mulAdd=function(a,b,c,d){var e,f=c.output,g=d.output;for(e=0;a>e;e++)b[e]=b[e]*f[e]+g[e]},flock.onMulAddInputChanged=function(a){var b,c=a.inputs.mul,d=a.inputs.add;return c||d?(b=c?d?c.rate!==flock.rates.AUDIO?d.rate!==flock.rates.AUDIO?flock.krMulKrAdd:flock.krMulAdd:d.rate!==flock.rates.AUDIO?flock.mulKrAdd:flock.mulAdd:c.rate!==flock.rates.AUDIO?flock.krMul:flock.mul:d.rate!==flock.rates.AUDIO?flock.krAdd:flock.add,void(a.mulAdd=function(e){b(e,a.output,c,d)})):void(a.mulAdd=flock.noOp)},flock.ugen=function(a,b,c){c=c||{};var d={rate:c.rate||flock.rates.AUDIO,inputs:a,output:b,options:c,model:c.model||{unscaledValue:0,value:0},multiInputs:{},tags:["flock.ugen"]};return d.lastOutputIdx=d.output.length-1,d.get=function(a){return flock.input.get(d.inputs,a)},d.set=function(a,b){return flock.input.set(d.inputs,a,b,d,function(a){return null!==a&&void 0!==a?flock.parse.ugenDef(a,{audioSettings:d.options.audioSettings,buses:d.options.buses,buffers:d.options.buffers}):void 0})},d.input=function(a,b){return a?"string"==typeof a?arguments.length<2?d.get(a):d.set(a,b):flock.isIterable(a)?d.get(a):d.set(a,b):void 0},d.calculateStrides=function(){var a,b,c,e=d.model,f=d.options.strideInputs,g=d.inputs;if(e.strides=e.strides||{},f)for(a=0;a<f.length;a++)b=f[a],c=g[b],c?e.strides[b]=c.rate===flock.rates.AUDIO?1:0:fluid.log(fluid.logLevel.WARN,"An invalid input ('"+b+"') was found on a unit generator: "+d)},d.collectMultiInputs=function(){var a,b,c,e,f=d.options.multiInputNames,g=d.multiInputs;for(a=0;a<f.length;a++)b=f[a],c=g[b],c?c.length=0:c=g[b]=[],e=d.inputs[b],flock.ugen.collectMultiInputs(e,c)},d.onInputChanged=function(a){var b=d.options.multiInputNames;flock.onMulAddInputChanged(d),d.options.strideInputs&&d.calculateStrides(),!b||a&&!b.indexOf(a)||d.collectMultiInputs()},d.init=function(){var a,b,c,e=fluid.makeArray(d.options.tags),f=d.model,g=d.options;for(a=0;a<e.length;a++)d.tags.push(e[a]);if(b=g.audioSettings=g.audioSettings||flock.environment.audioSystem.model,f.sampleRate=g.sampleRate||b.rates[d.rate],f.nyquistRate=f.sampleRate,f.blockSize=d.rate===flock.rates.AUDIO?b.blockSize:1,f.sampleDur=1/f.sampleRate,d.interpolate=flock.interpolate.none,g.interpolation){var h=flock.interpolate[g.interpolation];h?d.interpolate=h:fluid.log(fluid.logLevel.IMPORTANT,"An invalid interpolation type of '"+g.interpolation+"' was specified. Defaulting to none.")}d.rate===flock.rates.DEMAND&&d.inputs.freq&&(c=flock.parse.ugenDefForConstantValue(1),d.inputs.freq=flock.parse.ugenDef(c))},d.init(),d},flock.ugen.collectMultiInputs=function(a,b){flock.isIterable(a)||(a=a=fluid.makeArray(a));for(var c=0;c<a.length;c++){var d=a[c];flock.ugen.collectChannelsForInput(d,b)}return b},flock.ugen.collectChannelsForInput=function(a,b){var c,d=flock.hasTag(a,"flock.ugen.multiChannelOutput"),e=d?a.output:[a.output];for(c=0;c<e.length;c++)b.push({rate:a.rate,output:e[c]});return b},flock.ugen.lastOutputValue=function(a,b){return b[a-1]},flock.ugen.buffer=function(a){a.onBufferInputChanged=function(b){var c=a.model,d=a.inputs;(c.bufDef!==d.buffer||"buffer"===b)&&(c.bufDef=d.buffer,flock.parse.bufferForDef(c.bufDef,a,flock.environment))},a.setBuffer=function(b){a.buffer=b,a.onBufferReady&&a.onBufferReady(b)},a.initBuffer=function(){a.buffer=a.model.bufDef=flock.bufferDesc({format:{sampleRate:a.options.audioSettings.rates.audio},data:{channels:[new Float32Array(a.output.length)]}})}},flock.ugen.value=function(a,b,c){var d=flock.ugen(a,b,c);return d.value=function(){return d.model.value},d.dynamicGen=function(a){for(var b=d.output,c=d.model,e=0;a>e;e++)b[e]=c.unscaledValue;d.mulAdd(a),c.value=flock.ugen.lastOutputValue(a,b)},d.onInputChanged=function(){var a=d.inputs,b=d.model;b.value=b.unscaledValue=a.value,"constant"!==d.rate?d.gen=d.dynamicGen:d.gen=void 0,flock.onMulAddInputChanged(d),d.dynamicGen(1)},d.onInputChanged(),d},fluid.defaults("flock.ugen.value",{rate:"control",inputs:{value:1,mul:null,add:null},ugenOptions:{model:{unscaledValue:1,value:1},tags:["flock.ugen.valueType"]}}),flock.ugen.silence=function(a,b,c){var d=flock.ugen(a,b,c);return d.onInputChanged=function(){for(var a=0;a<d.output.length;a++)d.output[a]=0},d.onInputChanged(),d},fluid.defaults("flock.ugen.silence",{rate:"constant"}),flock.ugen.passThrough=function(a,b,c){var d=flock.ugen(a,b,c);return d.gen=function(a){var b,c,e=d.model,f=d.inputs.source.output,g=d.output;for(b=0;b<f.length;b++)g[b]=c=f[b];for(;a>b;b++)g[b]=c=0;e.unscaledValue=c,d.mulAdd(a),e.value=flock.ugen.lastOutputValue(a,g)},d.onInputChanged(),d},fluid.defaults("flock.ugen.passThrough",{rate:"audio",inputs:{source:null,mul:null,add:null}}),flock.ugen.out=function(a,b,c){var d=flock.ugen(a,b,c);return d.gen=function(a){var b,c,e,f,g,h,i,j,k,l=d.model,m=d.multiInputs.sources,n=d.options.buses,o=d.inputs.bus.output[0],p=d.inputs.expand.output[0];if(b=m.length,c=Math.max(p,b),!(1>b)){for(e=0;c>e;e++)for(g=m[e%b],h=g.rate,i=n[o+e],j=h===flock.rates.AUDIO?1:0,k=0,f=0;a>f;f++,k+=j)i[f]=i[f]+g.output[k];l.value=l.unscaledValue=g.output[k],d.mulAdd(a)}},d.init=function(){d.sourceBuffers=[],d.onInputChanged()},d.init(),d},fluid.defaults("flock.ugen.out",{rate:"audio",inputs:{sources:null,bus:0,expand:2},ugenOptions:{tags:["flock.ugen.outputType"],multiInputNames:["sources"]}}),flock.ugen.valueOut=function(a,b,c){var d=flock.ugen(a,b,c);return d.arraySourceGen=function(){var a,b=d.model,c=d.inputs.sources;for(a=0;a<c.length;a++)b.value[a]=c[a].output[0]},d.ugenSourceGen=function(){d.model.value=d.model.unscaledValue=d.inputs.sources.output[0]},d.onInputChanged=function(){var a=d.model,b=d.inputs.sources;flock.isIterable(b)?(d.gen=d.arraySourceGen,a.value=new Float32Array(b.length),a.unscaledValue=a.value):d.gen=d.ugenSourceGen},d.onInputChanged(),d},fluid.defaults("flock.ugen.valueOut",{rate:"control",inputs:{sources:null},ugenOptions:{model:{unscaledValue:null,value:null},tags:["flock.ugen.outputType","flock.ugen.valueType"]}}),flock.ugen["in"]=function(a,b,c){var d=flock.ugen(a,b,c);return d.singleBusGen=function(a){var b=d.model,c=d.output;flock.ugen["in"].readBus(a,c,d.inputs.bus,d.options.buses),b.unscaledValue=flock.ugen.lastOutputValue(a,c),d.mulAdd(a),b.value=flock.ugen.lastOutputValue(a,c)},d.multiBusGen=function(a){var b,c,e,f,g=d.model,h=d.inputs.bus,i=d.options.buses,j=d.output;for(b=0;a>b;b++){for(f=0,c=0;c<h.length;c++)e=0|h[c].output[0],f+=i[e][b];j[b]=f}g.unscaledValue=f,d.mulAdd(a),g.value=flock.ugen.lastOutputValue(a,j)},d.onInputChanged=function(){d.gen=flock.isIterable(d.inputs.bus)?d.multiBusGen:d.singleBusGen,flock.onMulAddInputChanged(d)},d.onInputChanged(),d},flock.ugen["in"].readBus=function(a,b,c,d){var e,f=0|c.output[0],g=d[f];for(e=0;a>e;e++)b[e]=g[e]},fluid.defaults("flock.ugen.in",{rate:"audio",inputs:{bus:0,mul:null,add:null}}),flock.ugen.audioIn=function(a,b,c){var d=flock.ugen(a,b,c);return d.gen=function(a){var b,c,e=d.model,f=d.output,g=d.bus;for(b=0;a>b;b++)f[b]=c=g[b];e.unscaledValue=c,d.mulAdd(a),e.value=flock.ugen.lastOutputValue(a,f)},d.onInputChanged=function(){flock.onMulAddInputChanged(d)},d.init=function(){var a=flock.environment.audioStrategy.inputDeviceManager.openAudioDevice(c);d.bus=d.options.buses[a],d.onInputChanged()},d.init(),d},fluid.defaults("flock.ugen.audioIn",{rate:"audio",inputs:{mul:null,add:null}})}();var fluid=fluid||require("infusion"),flock=fluid.registerNamespace("flock");!function(){"use strict";flock.blit=function(a){var b,c;return a>=2?b=0:a>=1?(c=2-a,b=.16666666666666666*c*c*c):a>=0?(c=a*a,b=.6666666666666666-c+.5*c*a):a>=-1?(c=a*a,b=.6666666666666666-c-.5*c*a):a>=-2?(c=2+a,b=.16666666666666666*c*c*c):b=0,b},flock.blit.period=function(a,b){var c=a/b;return 1>c?1:c},flock.blit.updatePeriodState=function(a,b){a.freq=1e-6>b?1e-6:b,a.d0=flock.blit.period(a.sampleRate,a.freq)},flock.ugen.blit=function(a,b,c){var d=flock.ugen(a,b,c);return d.gen=function(a){var b,c,e=d.model,f=d.output,g=d.inputs.freq.output[0],h=e.phase;for(b=0;a>b;b++)h-=1,-2>h&&(flock.blit.updatePeriodState(e,g),h+=e.d0),c=flock.blit(h),f[b]=c;e.phase=h,e.unscaledValue=c,d.mulAdd(a),e.value=flock.ugen.lastOutputValue(a,f)},d.init=function(){d.onInputChanged()},d.init(),d},fluid.defaults("flock.ugen.blit",{rate:"audio",inputs:{freq:440,mul:null,add:null},ugenOptions:{model:{phase:-2,unscaledValue:0,value:0}}}),flock.ugen.saw=function(a,b,c){var d=flock.ugen(a,b,c);return d.gen=function(a){var b,c=d.model,e=d.output,f=d.inputs.freq.output[0],g=1-d.inputs.leakRate.output[0],h=c.phase,i=c.unscaledValue;for(void 0===h&&(flock.ugen.saw.updatePeriodState(c,f),h=c.d0/2),b=0;a>b;b++)h-=1,-2>h&&(flock.ugen.saw.updatePeriodState(c,f),h+=c.d0),e[b]=i=flock.blit(h)-c.dcOffset+g*i;c.phase=h,c.unscaledValue=i,d.mulAdd(a),c.value=flock.ugen.lastOutputValue(a,e)},d.init=function(){d.onInputChanged()},d.init(),d},flock.ugen.saw.updatePeriodState=function(a,b){flock.blit.updatePeriodState(a,b),a.dcOffset=1/a.d0},fluid.defaults("flock.ugen.saw",{rate:"audio",inputs:{freq:440,leakRate:.01,mul:null,add:null},ugenOptions:{model:{phase:void 0,dcOffset:void 0,unscaledValue:0,value:0}}}),flock.ugen.square=function(a,b,c){var d=flock.ugen(a,b,c);return d.gen=function(a){var b,c=d.model,e=d.output,f=d.inputs.freq.output[0],g=1-d.inputs.leakRate.output[0],h=c.phase,i=c.unscaledValue;for(void 0===h&&(flock.ugen.square.updatePeriodState(c,f),h=c.phaseResetValue),b=0;a>b;b++)e[b]=i=flock.blit(h)*c.sign+g*i,-2>h&&(flock.ugen.square.updatePeriodState(c,f),h+=c.phaseResetValue),h-=1;c.phase=h,c.unscaledValue=i,d.mulAdd(a),c.value=flock.ugen.lastOutputValue(a,e)},d.init=function(){d.onInputChanged()},d.init(),d},flock.ugen.square.updatePeriodState=function(a,b){flock.blit.updatePeriodState(a,b),a.phaseResetValue=a.d0/2,a.sign*=-1},fluid.defaults("flock.ugen.square",{rate:"audio",inputs:{freq:440,leakRate:.01,mul:null,add:null},ugenOptions:{model:{phase:void 0,unscaledValue:.5,value:.5,sign:1}}}),flock.ugen.tri=function(a,b,c){var d=flock.ugen(a,b,c);return d.gen=function(a){var b,c,e,f=d.model,g=d.output,h=d.inputs.freq.output[0],i=1-d.inputs.leakRate.output[0],j=f.phase,k=f.unscaledValue,l=f.secondPrevVal;for(void 0===j&&(flock.ugen.tri.updatePeriodState(f,h),j=f.d0/4),b=0;a>b;b++)c=flock.blit(j)*f.sign+i*k,k=c,e=c+i*l,l=e,g[b]=e*f.ampScale,j-=1,-2>j&&(flock.ugen.tri.updatePeriodState(f,h),j+=f.phaseResetValue);f.phase=j,f.unscaledValue=k,f.secondPrevVal=l,d.mulAdd(a),f.value=flock.ugen.lastOutputValue(a,g)},d.init=function(){d.onInputChanged()},d.init(),d},flock.ugen.tri.updatePeriodState=function(a,b){flock.blit.updatePeriodState(a,b),a.phaseResetValue=a.d0/2,a.ampScale=2/a.d0,a.sign*=-1},fluid.defaults("flock.ugen.tri",{rate:"audio",inputs:{freq:440,leakRate:.01,mul:null,add:null},ugenOptions:{model:{phase:void 0,value:.5,unscaledValue:.5,secondPrevVal:0,sign:1,ampScale:void 0,phaseResetValue:void 0}}})}();var fluid=fluid||require("infusion"),flock=fluid.registerNamespace("flock");!function(){"use strict";var a=fluid.registerNamespace("jQuery");fluid.registerNamespace("flock.ugen"),flock.ugen.scope=function(a,b,c){var d=flock.ugen(a,b,c);return d.gen=function(a){var b,c=d.model,e=d.inputs.source.output,f=c.spf,g=c.bufIdx,h=c.scope.values;for(b=0;a>b;b++)h[g]=e[b],f>g?g+=1:(g=0,d.scopeView.refreshView());c.bufIdx=g,c.value=c.unscaledValue=flock.ugen.lastOutputValue(a,e)},d.onInputChanged=function(){d.output=d.inputs.source.output},d.init=function(){d.model.spf=Math.round(d.model.sampleRate/d.options.fps),d.model.bufIdx=0,d.model.scope=d.options.styles,d.model.scope.values=new Float32Array(d.model.spf),d.scopeView=flock.view.scope(d.options.canvas,d.model.scope),d.onInputChanged(),d.scopeView.refreshView()},d.init(),d},fluid.defaults("flock.ugen.scope",{rate:"audio",inputs:{source:null},ugenOptions:{fps:60,styles:{strokeColor:"#777777",strokeWidth:1}}}),flock.ugen.mouse={},flock.ugen.mouse.cursor=function(b,c,d){var e=flock.ugen(b,c,d);return e.exponentialGen=function(a){var b,c,d=e.model,f=flock.ugen.mouse.cursor.normalize(e.target,d),g=d.movingAvg,h=e.inputs.lag.output[0],i=e.inputs.add.output[0],j=e.inputs.mul.output[0],k=d.lagCoef,l=e.output;for(h!==k&&(k=0===h?0:Math.exp(flock.LOG001/(h*d.sampleRate)),d.lagCoef=k),b=0;a>b;b++)c=j+i,f=Math.pow(c/i,f)*i,g=f+k*(g-f),l[b]=g;d.movingAvg=g,d.value=d.unscaledValue=g},e.linearGen=function(a){var b,c=e.model,d=flock.ugen.mouse.cursor.normalize(e.target,c),f=c.movingAvg,g=e.inputs.lag.output[0],h=e.inputs.add.output[0],i=e.inputs.mul.output[0],j=c.lagCoef,k=e.output;for(g!==j&&(j=0===g?0:Math.exp(flock.LOG001/(g*c.sampleRate)),c.lagCoef=j),b=0;a>b;b++)f=d+j*(f-d),k[b]=f*i+h;c.movingAvg=c.unscaledValue=f,c.value=flock.ugen.lastOutputValue(a,k)},e.noInterpolationGen=function(a){var b,c=e.model,d=e.output,f=flock.ugen.mouse.cursor.normalize(e.target,c);for(b=0;a>b;b++)d[b]=f*e.inputs.mul.output[0]+e.inputs.add.output[0];c.value=c.unscaledValue=flock.ugen.lastOutputValue(a,d)},e.moveListener=function(a){var b=e.model;b.mousePosition=a[b.eventProp]},e.overListener=function(){e.model.isWithinTarget=!0},e.outListener=function(){var a=e.model;a.isWithinTarget=!1,a.mousePosition=0},e.downListener=function(){e.model.isMouseDown=!0},e.upListener=function(){var a=e.model;a.isMouseDown=!1,a.mousePosition=0},e.moveWhileDownListener=function(a){e.model.isMouseDown&&e.moveListener(a)},e.bindEvents=function(){var a=e.target,b=e.moveListener;e.options.onlyOnMouseDown&&(a.mousedown(e.downListener),a.mouseup(e.upListener),b=e.moveWhileDownListener),a.mouseover(e.overListener),a.mouseout(e.outListener),a.mousemove(b)},e.onInputChanged=function(){flock.onMulAddInputChanged(e);var a=e.options.interpolation;e.gen="none"===a?e.noInterpolationGen:"exponential"===a?e.exponentialGen:e.linearGen},e.init=function(){var b=e.model,c=e.options,d=c.axis,f=a(c.target||window);"x"===d||"width"===d||"horizontal"===d?(b.eventProp="clientX",b.offsetProp="left",b.dimension="width"):(b.eventProp="clientY",b.offsetProp="top",b.dimension="height"),e.target=f,b.mousePosition=0,b.movingAvg=0,e.bindEvents(),e.onInputChanged()},e.init(),e},flock.ugen.mouse.cursor.normalize=function(a,b){if(!b.isWithinTarget)return 0;var c=a[b.dimension](),d=a.offset(),e=b.mousePosition;return d&&(e-=d[b.offsetProp]),e/c},fluid.defaults("flock.ugen.mouse.cursor",{rate:"control",inputs:{lag:.5,add:0,mul:1},ugenOptions:{axis:"x",interpolation:"linear",model:{mousePosition:0,movingAvg:0,value:0}}}),flock.ugen.mouse.click=function(b,c,d){var e=flock.ugen(b,c,d);return e.gen=function(a){var b,c=e.output,d=e.model;for(b=0;a>b;b++)c[b]=d.unscaledValue;e.mulAdd(a),d.value=flock.ugen.lastOutputValue(a,c)},e.mouseDownListener=function(){e.model.unscaledValue=1},e.mouseUpListener=function(){e.model.unscaledValue=0},e.init=function(){var b=e.model;b.target=a(e.options.target?e.options.target:window),b.target.mousedown(e.mouseDownListener),b.target.mouseup(e.mouseUpListener),e.onInputChanged()},e.onInputChanged=function(){flock.onMulAddInputChanged(e)},e.init(),e},fluid.defaults("flock.ugen.mouse.click",{rate:"control"}),flock.ugen.mediaIn=function(b,c,d){var e=flock.ugen(b,c,d);return e.gen=function(a){for(var b,c=e.model,d=e.output,f=e.bus,g=0;a>g;g++)d[g]=b=f[g];c.unscaledValue=b,e.mulAdd(a),c.value=flock.ugen.lastOutputValue(a,d)},e.onInputChanged=function(){flock.onMulAddInputChanged(e)},e.init=function(){var b=flock.environment,c=a(e.options.element),d=b.audioStrategy.nativeNodeManager.createMediaElementInput(c[0]);e.bus=e.options.buses[d],e.onInputChanged(),flock.platform.browser.safari?flock.log.warn("MediaElementSourceNode does not work on Safari. For more information, see https://bugs.webkit.org/show_bug.cgi?id=84743 and https://bugs.webkit.org/show_bug.cgi?id=125031"):flock.platform.isAndroid&&flock.log.warn("MediaElementSourceNode does not work on Android. For more information, see https://code.google.com/p/chromium/issues/detail?id=419446")},e.init(),e},fluid.defaults("flock.ugen.mediaIn",{rate:"audio",inputs:{mul:null,add:null},ugenOptions:{element:"audio"}})}();var fluid=fluid||require("infusion"),flock=fluid.registerNamespace("flock");!function(){"use strict";flock.ugen.playBuffer=function(a,b,c){var d=flock.ugen(a,b,c);return d.defaultKrTriggerGen=function(b){var c,e,f=d.model,g=d.output,h=d.inputs.channel.output[0],i=d.buffer.data.channels[h],j=f.idx,k=d.inputs.loop.output[0],l=a.trigger.output[0];for(l>0&&f.prevTrig<=0&&(j=0),f.prevTrig=l,c=0;b>c;c++){if(j>f.lastIdx){if(!(k>0&&l>0)){g[c]=e=0;continue}j=0}e=d.interpolate(j,i),g[c]=e,j++}f.idx=j,f.unscaledValue=e,d.mulAdd(b),f.value=flock.ugen.lastOutputValue(b,g)},d.otherwiseGen=function(b){var c,e,f,g,h,i,j=d.model,k=d.output,l=d.inputs.channel.output[0],m=d.inputs.speed.output,n=d.buffer.data.channels[l],o=a.trigger.output,p=j.idx,q=d.inputs.loop.output[0],r=d.inputs.start.output[0]*j.lastIdx|0,s=d.inputs.end.output[0]*j.lastIdx|0;for(c=0,e=0,f=0;b>c;c++,e+=j.strides.trigger,f+=j.strides.speed){if(g=o[e],h=m[f],g>0&&j.prevTrig<=0)p=flock.ugen.playBuffer.resetIndex(h,r,s);else if(r>p||p>s){if(!(q>0&&g>0)){k[c]=i=0;continue}p=flock.ugen.playBuffer.resetIndex(h,r,s)}j.prevTrig=o[e],i=d.interpolate(p,n),k[c]=i,p+=j.stepSize*h}j.idx=p,j.unscaledValue=i,d.mulAdd(b),j.value=flock.ugen.lastOutputValue(b,k)},d.onInputChanged=function(a){var b=d.inputs,c=b.speed,e=b.start,f=b.end,g=b.trigger;d.onBufferInputChanged(a),d.gen=c.rate===flock.rates.CONSTANT&&1===c.output[0]&&e.rate===flock.rates.CONSTANT&&0===e.output[0]&&f.rate===flock.rates.CONSTANT&&1===f.output[0]&&g.rate!==flock.rates.AUDIO?d.defaultKrTriggerGen:d.otherwiseGen,d.calculateStrides(),flock.onMulAddInputChanged(d)},d.onBufferReady=function(){var a=d.model,b=d.inputs.end.output[0],c=d.inputs.channel.output[0],e=d.buffer.data.channels[c],f=e.length;a.idx=b*f|0,a.lastIdx=f-1,a.stepSize=d.buffer.format.sampleRate/a.sampleRate},d.init=function(){flock.ugen.buffer(d),d.initBuffer(),d.onInputChanged()},d.init(),d},flock.ugen.playBuffer.resetIndex=function(a,b,c){return a>0?b:c},fluid.defaults("flock.ugen.playBuffer",{rate:"audio",inputs:{channel:0,loop:0,speed:1,start:0,end:1,trigger:1,buffer:null,mul:null,add:null},ugenOptions:{model:{finished:!1,unscaledValue:0,value:0,idx:0,stepSize:0,prevTrig:0,channel:void 0},strideInputs:["trigger","speed"],interpolation:"linear"}}),flock.ugen.readBuffer=function(a,b,c){var d=flock.ugen(a,b,c);return d.gen=function(a){var b,c,e,f,g=d.model,h=g.strides.phase,i=d.output,j=d.inputs.channel.output[0],k=d.inputs.phase.output,l=d.buffer.data.channels[j],m=l.length;for(b=e=0;a>b;b++,e+=h)c=k[e]*m,f=d.interpolate(c,l),i[b]=f;g.unscaledValue=f,d.mulAdd(a),g.value=flock.ugen.lastOutputValue(a,i)},d.onInputChanged=function(a){d.onBufferInputChanged(a),d.calculateStrides(),flock.onMulAddInputChanged(d)},d.init=function(){flock.ugen.buffer(d),d.initBuffer(),d.onInputChanged()},d.init(),d},fluid.defaults("flock.ugen.readBuffer",{rate:"audio",inputs:{buffer:null,channel:0,phase:0,mul:null,add:null},ugenOptions:{model:{channel:void 0,unscaledValue:0,value:0},strideInputs:["phase"],interpolation:"linear"}}),flock.ugen.writeBuffer=function(a,b,c){var d=flock.ugen(a,b,c);return d.gen=function(a){var b,c,e,f=d.model,g=d.output,h=d.inputs,i=d.buffer,j=d.multiInputs.sources,k=j.length,l=i.data.channels,m=i.format.numSampleFrames,n=h.start.output[0],o=h.loop.output[0];for(f.prevStart!==n&&(f.prevStart=n,f.writeIdx=Math.floor(n)),b=0;k>b;b++){var p=j[b].output,q=l[b],r=g[b];for(c=f.writeIdx,e=0;a>e;e++){var s=p[e];r&&(r[e]=s),m>c?q[c]=s:o>0&&(c=Math.floor(n),q[c]=s),c++}}f.writeIdx=c,d.mulAdd(a)},d.createBuffer=function(a,b){var c,d=a.options,e=d.audioSettings,f=d.buffers,g=a.multiInputs.sources.length,h=Math.round(a.options.duration*e.rates.audio),i=new Array(g);for(c=0;g>c;c++)i[c]=new Float32Array(h);var j=flock.bufferDesc(i,e.rates.audio,g);return b.id&&(j.id=b.id,f[b.id]=j),j},d.setupBuffer=function(a){a="string"==typeof a?{id:a}:a;var b;return a.id&&(b=d.options.buffers[a.id]),d.buffer=b||d.createBuffer(d,a),d.buffer},d.onInputChanged=function(a){a?"sources"===a?d.collectMultiInputs():"buffer"===a&&d.setupBuffer(d.inputs.buffer):(d.collectMultiInputs(),d.setupBuffer(d.inputs.buffer)),flock.onMulAddInputChanged(d)},d.init=function(){d.onInputChanged()},d.init(),d},fluid.defaults("flock.ugen.writeBuffer",{rate:"audio",inputs:{sources:null,buffer:null,start:0,loop:0},ugenOptions:{model:{prevStart:void 0,writeIdx:0},tags:["flock.ugen.multiChannelOutput"],numOutputs:2,multiInputNames:["sources"],duration:600}}),flock.ugen.bufferDuration=function(a,b,c){var d=flock.ugen(a,b,c);return d.krGen=function(a){var b,c=d.model,e=d.output,f=d.inputs.channel.output[0],g=d.buffer.data.channels[f],h=d.buffer.format.sampleRate;for(b=0;a>b;b++)e[b]=g.length/h;c.unscaledValue=c.value=flock.ugen.lastOutputValue(a,e)},d.onInputChanged=function(a){d.onBufferInputChanged(a)},d.onBufferReady=function(){d.krGen(1)},d.init=function(){var a=d.rate;d.gen=a===flock.rates.CONTROL||a===flock.rates.AUDIO?d.krGen:void 0,d.output[0]=0,flock.ugen.buffer(d),d.initBuffer(),d.onInputChanged()},d.init(),d},fluid.defaults("flock.ugen.bufferDuration",{rate:"constant",inputs:{buffer:null,channel:0},ugenOptions:{model:{unscaledValue:0,value:0}}}),flock.ugen.bufferLength=function(a,b,c){var d=flock.ugen(a,b,c);return d.krGen=function(a){var b,c=d.model,e=d.output,f=d.inputs.channel.output[0],g=d.buffer.data.channels[f],h=g.length;for(b=0;a>b;b++)e[b]=h;c.value=c.unscaledValue=h},d.onInputChanged=function(a){d.onBufferInputChanged(a)},d.onBufferReady=function(){d.krGen(1)},d.init=function(){var a=d.rate;d.gen=a===flock.rates.CONTROL||a===flock.rates.AUDIO?d.krGen:void 0,d.output[0]=0,flock.ugen.buffer(d),d.initBuffer(),d.onInputChanged()},d.init(),d},fluid.defaults("flock.ugen.bufferLength",{rate:"constant",inputs:{buffer:null,channel:0},ugenOptions:{model:{unscaledValue:0,value:0}}}),flock.ugen.bufferPhaseStep=function(a,b,c){var d=flock.ugen(a,b,c);return d.krGen=function(a){var b,c=d.model,e=d.output,f=c.unscaledValue;for(b=0;a>b;b++)e[b]=f;d.mulAdd(a),c.value=flock.ugen.lastOutputValue(a,e)},d.onInputChanged=function(a){d.onBufferInputChanged(a),flock.onMulAddInputChanged(d)},d.onBufferReady=function(a){var b=d.model,c=d.inputs.channel.output[0],e=a.data.channels[c],f=d.options.audioSettings.rates.audio,g=d.buffer.format.sampleRate||f;b.scale=g/f,d.output[0]=b.unscaledValue=1/(e.length*b.scale)},d.init=function(){var a=d.rate;d.gen=a===flock.rates.CONTROL||a===flock.rates.AUDIO?d.krGen:void 0,d.output[0]=0,flock.ugen.buffer(d),d.initBuffer(),d.onInputChanged()},d.init(),d},fluid.defaults("flock.ugen.bufferPhaseStep",{rate:"constant",inputs:{buffer:null,channel:0},ugenOptions:{model:{scale:1,unscaledValue:0,value:0}}}),flock.ugen.sampleRate=function(a,b,c){var d=flock.ugen(a,b,c),e=d.model;return d.output[0]=e.value=e.unscaledValue=d.options.audioSettings.rates.audio,d},fluid.defaults("flock.ugen.sampleRate",{rate:"constant",inputs:{}})}();var fluid=fluid||require("infusion"),flock=fluid.registerNamespace("flock");!function(){"use strict";flock.ugen.print=function(a,b,c){var d=flock.ugen(a,b,c);return d.gen=function(a){var b,c,e,f=d.inputs,g=d.output,h=d.model,i=h.label,j=f.channel,k=j?f.source.output[j.output[0]]:f.source.output,l=f.trigger.output[0],m=f.freq.output[0];for(l>0&&h.prevTrig<=0&&fluid.log(fluid.logLevel.IMPORTANT,i+k),h.freq!==m&&(h.sampInterval=Math.round(h.sampleRate/m),h.freq=m,h.counter=h.sampInterval),b=0,c=0;a>b;b++,c+=h.strides.source)h.counter>=h.sampInterval&&(fluid.log(fluid.logLevel.IMPORTANT,i+k[c]),h.counter=0),h.counter++,g[b]=e=k[b];h.value=h.unscaledValue=e},d.init=function(){var a=d.options;d.model.label=a.label?a.label+": ":"",d.onInputChanged()},d.init(),d},fluid.defaults("flock.ugen.print",{rate:"audio",inputs:{source:null,trigger:0,freq:1},ugenOptions:{model:{unscaledValue:0,value:0,counter:0},strideInputs:["source"]}})}();var fluid=fluid||require("infusion"),flock=fluid.registerNamespace("flock");!function(){"use strict";flock.ugen.distortion=function(a,b,c){var d=flock.ugen(a,b,c);return d.gen=function(a){var b,c,e,f,g,h=d.model,i=d.output,j=d.inputs.source.output,k=h.strides.source,l=d.inputs.gain.output,m=h.strides.gain;for(e=f=g=0;a>e;e++,f+=k,g+=m)b=j[f]*l[g],c=1.5*b-.5*b*b*b,i[e]=c;h.unscaledValue=c,d.mulAdd(a),h.value=flock.ugen.lastOutputValue(a,i)},d.onInputChanged(),d},fluid.defaults("flock.ugen.distortion",{rate:"audio",inputs:{source:null,gain:1},ugenOptions:{strideInputs:["source","gain"]}}),flock.ugen.distortion.deJonge=function(a,b,c){var d=flock.ugen(a,b,c);return d.gen=function(a){var b,c,e,f,g,h,i,j=d.model,k=d.output,l=d.inputs.source.output,m=j.strides.source,n=d.inputs.amount.output,o=j.strides.amount;for(g=h=i=0;a>g;g++,h+=m,i+=o)b=l[h],c=n[i],e=Math.abs(b),f=b*(e+c)/(b*b+(c-1)*e+1),k[g]=f;j.unscaledValue=f,d.mulAdd(a),j.value=flock.ugen.lastOutputValue(a,k)},d.onInputChanged(),d},fluid.defaults("flock.ugen.distortion.deJonge",{rate:"audio",inputs:{source:null,amount:2},ugenOptions:{strideInputs:["source","amount"]}}),flock.ugen.distortion.tarrabiaDeJonge=function(a,b,c){var d=flock.ugen(a,b,c);return d.gen=function(a){var b,c,e,f,g,h,i,j=d.model,k=d.output,l=d.inputs.source.output,m=j.strides.source,n=d.inputs.amount.output,o=j.strides.amount;for(f=g=h=0;a>f;f++,g+=m,h+=o)b=l[g],c=n[h],c>=1?c=.9999999999999999:-1>c&&(c=-1),i=2*c/(1-c),e=(1+i)*b/(1+i*Math.abs(b)),k[f]=e;j.unscaledValue=e,d.mulAdd(a),j.value=flock.ugen.lastOutputValue(a,k)},d.onInputChanged(),d},fluid.defaults("flock.ugen.distortion.tarrabiaDeJonge",{rate:"audio",inputs:{source:null,amount:10},ugenOptions:{strideInputs:["source","amount"]}}),flock.ugen.distortion.gloubiBoulga=function(a,b,c){var d=flock.ugen(a,b,c);return d.gen=function(a){var b,c,e,f,g,h,i,j,k=d.model,l=d.output,m=d.inputs.source.output,n=k.strides.source,o=d.inputs.gain.output,p=k.strides.gain;for(e=f=g=0;a>e;e++,f+=n,g+=p)b=m[f]*o[g],h=.686306*b,i=1+Math.exp(Math.sqrt(Math.abs(h))*-.75),j=Math.exp(h),c=(j-Math.exp(-h*i))/(j+Math.exp(-h)),l[e]=c;k.unscaledValue=c,d.mulAdd(a),k.value=flock.ugen.lastOutputValue(a,l)},d.onInputChanged(),d},fluid.defaults("flock.ugen.distortion.gloubiBoulga",{rate:"audio",inputs:{source:null,gain:1},ugenOptions:{strideInputs:["source","gain"]}})}();var fluid=fluid||require("infusion"),flock=fluid.registerNamespace("flock");!function(){"use strict";flock.ugen.normalize=function(a,b,c){var d=flock.ugen(a,b,c);return d.gen=function(){var a=d.model,b=d.output,c=d.inputs.max.output[0],e=d.inputs.source.output;flock.normalize(e,c,b),a.value=a.unscaledValue=b[b.length-1]},d.onInputChanged(),d},fluid.defaults("flock.ugen.normalize",{rate:"audio",inputs:{max:1,source:null}})}();var fluid=fluid||require("infusion"),flock=fluid.registerNamespace("flock");!function(){"use strict";var a=fluid.registerNamespace("jQuery"),b=flock.requireModule("webarraymath","ArrayMath");flock.envelope={},flock.envelope.makeCreator=function(b,c){return function(d){var e=fluid.defaults(b),f=a.extend(!0,{},e,d);return c(f)}},flock.envelope.registerCreators=function(a,b){var c,d;for(var e in b)c=fluid.pathUtil.composePath(a,e),d=b[e],fluid.defaults(c,d.defaults),fluid.setGlobalValue(c,flock.envelope.makeCreator(c,d.transformer))},flock.envelope.creatorSpecs={line:{transformer:function(a){return{levels:[a.start,a.end],times:[a.duration]}},defaults:{start:0,end:1,duration:1}},linear:{transformer:function(a){return{levels:[0,a.level,a.level,0],times:[a.attack,a.sustain,a.release]}},defaults:{level:1,attack:.01,sustain:1,release:1}},tri:{transformer:function(a){return{levels:[0,a.level,0],times:[a.duration,a.duration]}},defaults:{level:1,duration:1}},sin:{transformer:function(a){return{levels:[0,a.level,0],times:[a.duration,a.duration],curve:"sin"}},defaults:{level:1,duration:1}},asr:{transformer:function(a){return{levels:[0,a.sustain,0],times:[a.attack,a.release],sustainPoint:1,curve:-4}},defaults:{sustain:1,attack:.01,release:1}},dadsr:{transformer:function(a){var c=[0,0,a.peak,a.peak*a.sustain,0];return b.add(c,a.bias,c),{levels:c,times:[a.delay,a.attack,a.decay,a.release],sustainPoint:3,curve:-4}},defaults:{delay:.1,attack:.01,decay:.3,sustain:.5,release:1,peak:1,bias:0}},adsr:{transformer:function(a){var c=[0,a.peak,a.peak*a.sustain,0];return b.add(c,a.bias,c),{levels:c,times:[a.attack,a.decay,a.release],sustainPoint:2,curve:-4}},defaults:{attack:.01,decay:.3,sustain:.5,release:1,peak:1,bias:0}}},flock.envelope.registerCreators("flock.envelope",flock.envelope.creatorSpecs),flock.envelope.validate=function(a,b){var c=a.levels,d={};if(a.times?!c||c.length<2?d.levels="An array containing at least two levels must be specified.":(flock.envelope.validate.times(a.times,c,d),flock.envelope.validate.levels(c,d),flock.envelope.validate.curves(a.curve,c,d),flock.envelope.validate.sustainPoint(a.sustainPoint,c,d)):d.times="An array containing at least one time value must be specified.",b!==!1)for(var e in d)flock.fail(d[e]);return d},flock.envelope.validate.times=function(a,b,c){a.length!==b.length-1&&(c.times="The envelope specification should provide one fewer time value than the number of level values. times: "+a+" levels: "+b);for(var d=0;d<a.length;d++){var e=a[d];isNaN(e)&&(c.times="A NaN time value was specified at index "+d+". times: "+a),0>e&&(c.times="All times should be positive values. times: "+a)}},flock.envelope.validate.levels=function(a,b){for(var c=0;c<a.length;c++)isNaN(a[c])&&(b.levels="A NaN level value was specified at index "+c+". levels: "+a)},flock.envelope.validate.curves=function(a,b,c){if(!a)return c;flock.isIterable(a)&&(a.length!==b.length-1&&(c.curve="When curve is specified as an array, there should be one fewer curve value than the number of level values. curve: "+a+" levels: "+b),fluid.each(a,function(b){var d=flock.line.generator(b);d||(c.curve="'"+b+"' is not a valid curve type. curve: "+a)}));var d=flock.line.generator(a);d||(c.curve="'"+a+"' is not a valid curve type.")},flock.envelope.validate.sustainPoint=function(a,b,c){(0>a||a>=b.length)&&(c.sustainPoint="The specified sustainPoint index is out range for the levels array. sustainPoint: "+a+" levels: "+b)},flock.envelope.expand=function(a){var b="string"==typeof a?fluid.invokeGlobalFunction(a):a.type?fluid.invokeGlobalFunction(a.type,[a]):a;if(b.curves&&!b.curve&&(b.curve=b.curves),!flock.isIterable(b.curve)){var c=b.levels.length-1;b.curve=flock.generate(new Array(c),b.curve)}return flock.envelope.validate(b,!0),b},flock.line={fill:function(a,b,c,d,e,f){e=void 0===e?0:e,f=void 0===f?b.length:f;var g=f-e,h=flock.line.fill.model;h.unscaledValue=c,h.destination=d,h.numSegmentSamps=g-1,"number"==typeof a&&(h.currentCurve=a,a="curve");var i=flock.line[a];return i||flock.fail("No line generator could be found for type "+a),i.init(h),i.gen(g,e,b,h)},generator:function(a){var b=typeof a;return"string"===b?flock.line[a]:"number"===b?flock.line.curve:flock.line.linear},constant:{init:function(a){a.stepSize=0},gen:function(a,b,c,d){for(var e=d.unscaledValue,f=b;a+b>f;f++)c[f]=e;return c}},step:{init:function(a){
a.arrived=!1},gen:function(a,b,c,d){for(var e=b;a+b>e;e++)c[e]=d.unscaledValue,d.arrived||(d.arrived=!0,d.unscaledValue=d.destination);return c}},linear:{init:function(a){a.stepSize=(a.destination-a.unscaledValue)/a.numSegmentSamps},gen:function(a,b,c,d){for(var e=d.unscaledValue,f=d.stepSize,g=b;a+b>g;g++)c[g]=e,e+=f;return d.unscaledValue=e,d.stepSize=f,c}},exponential:{init:function(a){0===a.unscaledValue&&(a.unscaledValue=1e-16),a.stepSize=0===a.numSegmentSamps?0:Math.pow(a.destination/a.unscaledValue,1/a.numSegmentSamps)},gen:function(a,b,c,d){for(var e=d.unscaledValue,f=d.stepSize,g=b;a+b>g;g++)c[g]=e,e*=f;return d.unscaledValue=e,d.stepSize=f,c}},curve:{init:function(a){if(Math.abs(a.currentCurve)<.001)return flock.line.linear.init(a);var b=(a.destination-a.unscaledValue)/(1-Math.exp(a.currentCurve));a.a2=a.unscaledValue+b,a.b1=b,a.stepSize=Math.exp(a.currentCurve/a.numSegmentSamps)},gen:function(a,b,c,d){for(var e=d.unscaledValue,f=d.b1,g=b;a+b>g;g++)c[g]=e,f*=d.stepSize,e=d.a2-f;return d.unscaledValue=e,d.b1=f,c}},sin:{init:function(a){var b=Math.PI/a.numSegmentSamps;a.a2=.5*(a.destination+a.unscaledValue),a.b1=2*Math.cos(b),a.y1=.5*(a.destination-a.unscaledValue),a.y2=a.y1*Math.sin(flock.HALFPI-b),a.unscaledValue=a.a2-a.y1},gen:function(a,b,c,d){for(var e,f=d.unscaledValue,g=d.y1,h=d.y2,i=b;a+b>i;i++)c[i]=f,e=d.b1*g-h,f=d.a2-e,h=g,g=e;return d.unscaledValue=f,d.y1=g,d.y2=h,c}},welsh:{init:function(a){var b=flock.HALFPI/a.numSegmentSamps,c=Math.cos(b);a.b1=2*c,a.destination>=a.unscaledValue?(a.a2=a.unscaledValue,a.y1=0,a.y2=-Math.sin(b)*(a.destination-a.unscaledValue)):(a.a2=a.destination,a.y1=a.unscaledValue-a.destination,a.y2=c*(a.unscaledValue-a.destination)),a.unscaledValue=a.a2+a.y1},gen:function(a,b,c,d){for(var e,f=d.unscaledValue,g=d.y1,h=d.y2,i=b;a+b>i;i++)c[i]=f,e=d.b1*g-h,h=g,g=e,f=d.a2+e;return d.unscaledValue=f,d.y1=g,d.y2=h,c}},squared:{init:function(a){a.y1=Math.sqrt(a.unscaledValue),a.y2=Math.sqrt(a.destination),a.stepSize=(a.y2-a.y1)/a.numSegmentSamps},gen:function(a,b,c,d){for(var e=d.unscaledValue,f=d.y1,g=b;a+b>g;g++)c[g]=e,f+=d.stepSize,e=f*f;return d.y1=f,d.unscaledValue=e,c}},cubed:{init:function(a){var b=.3333333333333333;a.y1=Math.pow(a.unscaledValue,b),a.y2=Math.pow(a.destination,b),a.stepSize=(a.y2-a.y1)/a.numSegmentSamps},gen:function(a,b,c,d){for(var e=d.unscaledValue,f=d.y1,g=b;a+b>g;g++)c[g]=e,f+=d.stepSize,e=f*f*f;return d.y1=f,d.unscaledValue=e,c}}},flock.line.fill.model={unscaledValue:0,value:0,destination:1},flock.ugen.line=function(a,b,c){var d=flock.ugen(a,b,c);return d.gen=function(a){var b,c=d.model,e=c.stepSize,f=c.numSteps,g=f>=a?a:f,h=a-g,i=c.level,j=d.output;for(b=0;g>b;b++)j[b]=i,f--,i+=e;if(h>0)for(b=0;h>b;b++)j[b]=i;c.level=c.unscaledValue=i,c.numSteps=f,d.mulAdd(a),c.value=flock.ugen.lastOutputValue(a,j)},d.onInputChanged=function(){var a=d.model;a.start=d.inputs.start.output[0],a.end=d.inputs.end.output[0],a.numSteps=Math.round(d.inputs.duration.output[0]*a.sampleRate),0===a.numSteps?(a.stepSize=0,a.level=a.end):(a.stepSize=(a.end-a.start)/a.numSteps,a.level=a.start),flock.onMulAddInputChanged(d)},d.onInputChanged(),d},fluid.defaults("flock.ugen.line",{rate:"control",inputs:{start:0,end:1,duration:1,mul:null,add:null},ugenOptions:{model:{start:0,end:1,numSteps:0,stepSize:0,level:0,unscaledValue:0,value:0}}}),flock.ugen.xLine=function(a,b,c){var d=flock.ugen(a,b,c);return d.gen=function(a){var b,c=d.model,e=c.multiplier,f=c.numSteps,g=f>=a?a:f,h=a-g,i=c.level,j=d.output;for(b=0;g>b;b++)j[b]=i,f--,i*=e;if(h>0)for(b=0;h>b;b++)j[b]=i;c.level=c.unscaledValue=i,c.numSteps=f,d.mulAdd(a),c.value=flock.ugen.lastOutputValue(a,j)},d.onInputChanged=function(){var a=d.model;flock.onMulAddInputChanged(d),a.start=d.inputs.start.output[0],0===a.start&&(a.start=1e-101),a.end=d.inputs.end.output[0],a.numSteps=Math.round(d.inputs.duration.output[0]*a.sampleRate),a.multiplier=Math.pow(a.end/a.start,1/a.numSteps),a.level=a.start},d.onInputChanged(),d},fluid.defaults("flock.ugen.xLine",{rate:"control",inputs:{start:0,end:1,duration:1,mul:null,add:null},ugenOptions:{model:{start:0,end:1,numSteps:0,multiplier:0,level:0,unscaledValue:0,value:0}}}),flock.ugen.asr=function(a,b,c){var d=flock.ugen(a,b,c);return d.gen=function(a){var b,c,e=d.model,f=d.output,g=e.previousGate,h=d.inputs.gate.output[0],i=e.level,j=e.stage,k=j.currentStep,l=j.stepInc,m=j.numSteps,n=e.targetLevel,o=!1;for(0>=g&&h>0?(n=d.inputs.sustain.output[0],b=d.inputs.attack.output[0],o=!0):0>=h&&k>=m&&(n=d.inputs.start.output[0],b=d.inputs.release.output[0],o=!0),o&&(m=Math.round(b*e.sampleRate),l=(n-i)/m,k=0),c=0;a>c;c++)f[c]=i,k++,i=m>k?i+l:k===m?n:i;e.level=e.unscaledValue=i,e.targetLevel=n,e.previousGate=h,j.currentStep=k,j.stepInc=l,j.numSteps=m,d.mulAdd(a),e.value=flock.ugen.lastOutputValue(a,f)},d.init=function(){var a=d.model;a.level=a.unscaledValue=d.inputs.start.output[0],a.targetLevel=d.inputs.sustain.output[0],d.onInputChanged()},d.init(),d},fluid.defaults("flock.ugen.asr",{rate:"control",inputs:{start:0,attack:.01,sustain:1,release:1,gate:0,mul:null,add:null},ugenOptions:{model:{level:0,targetLevel:0,previousGate:0,unscaledValue:0,value:0,stage:{currentStep:0,stepInc:0,numSteps:0}}}}),flock.ugen.env={},flock.ugen.env.simpleASR=flock.ugen.asr,fluid.defaults("flock.ugen.env.simpleASR",fluid.copy(fluid.defaults("flock.ugen.asr"))),flock.ugen.envGen=function(a,b,c){var d=flock.ugen(a,b,c);return d.krGen=function(a){var b,c=d.model,e=d.output,f=d.inputs,g=f.gate.output[0],h=f.timeScale.output[0],i=0;for(flock.ugen.envGen.checkGate(d,g,h);a>i;)b=Math.min(a-i,c.numSegmentSamps),d.lineGen.gen(b,i,e,c),i+=b,c.numSegmentSamps-=b,0===c.numSegmentSamps&&flock.ugen.envGen.nextStage(d,h);d.mulAdd(a),c.value=flock.ugen.lastOutputValue(a,e)},d.arGen=function(a){var b,c=d.model,e=d.output,f=d.inputs,g=f.gate.output,h=f.timeScale.output[0];for(b=0;a>b;b++)flock.ugen.envGen.checkGate(d,g[b],h),d.lineGen.gen(1,b,e,c),c.numSegmentSamps--,0===c.numSegmentSamps&&flock.ugen.envGen.nextStage(d,h);d.mulAdd(a),c.value=flock.ugen.lastOutputValue(a,e)},d.onInputChanged=function(a){a&&"envelope"!==a||(d.envelope=flock.ugen.envGen.initEnvelope(d,d.inputs.envelope)),a&&"gate"!==a||(d.gen=d.inputs.gate.rate===flock.rates.AUDIO?d.arGen:d.krGen),flock.onMulAddInputChanged(d)},d.onInputChanged(),d},flock.ugen.envGen.initEnvelope=function(a,b){var c=a.model,d=flock.envelope.expand(b);return c.stage=0,c.numStages=d.times.length,a.lineGen=flock.line.constant,flock.ugen.envGen.lineGenForStage(a.inputs.timeScale.output[0],d,c),c.unscaledValue=d.levels[c.stage],d},flock.ugen.envGen.checkGate=function(a,b,c){var d=a.model,e=a.envelope;b!==d.previousGate&&(b>0&&d.previousGate<=0?(d.stage=1,a.lineGen=flock.ugen.envGen.lineGenForStage(c,e,d)):0>=b&&d.previousGate>0&&(d.stage=d.numStages,a.lineGen=flock.ugen.envGen.lineGenForStage(c,e,d))),d.previousGate=b},flock.ugen.envGen.nextStage=function(a,b){var c=a.model,d=a.envelope;c.stage===d.sustainPoint?(a.lineGen=flock.line.constant,c.numSegmentSamps=1/0,c.destination=c.unscaledValue):(c.stage++,a.lineGen=flock.ugen.envGen.lineGenForStage(b,d,c))},flock.ugen.envGen.setupStage=function(a,b,c){var d,e,f=b.levels[c.stage];0===c.stage||c.stage>c.numStages?e=1/0:(d=b.times[c.stage-1]*a,e=Math.max(1,d*c.sampleRate)),c.numSegmentSamps=e,c.destination=f},flock.ugen.envGen.lineGenForStage=function(a,b,c){var d,e,f=b.curve;return 0===c.stage||c.stage>c.numStages?d=flock.line.constant:(e=f[c.stage-1],c.currentCurve=e,d=flock.line.generator(e)),flock.ugen.envGen.setupStage(a,b,c),d.init(c),d},fluid.defaults("flock.ugen.envGen",{rate:"audio",inputs:{envelope:"flock.envelope.adsr",gate:0,timeScale:1,mul:null,add:null},ugenOptions:{model:{previousGate:0,stepSize:0,destination:0,numSegmentSamps:1,unscaledValue:0,value:0,stage:0,numStages:0}}}),flock.ugen.phasor=function(a,b,c){var d=flock.ugen(a,b,c);return d.gen=function(a){var b,c,e,f=d.model,g=d.inputs,h=d.output,i=g.step.output,j=g.trigger.output;for(void 0===f.unscaledValue&&(f.unscaledValue=g.start.output[0]),b=0,c=0,e=0;a>b;b++,c+=f.strides.trigger,e+=f.strides.step)j[c]>0&&f.prevTrig<=0&&(f.unscaledValue=g.reset.output[0]),f.prevTrig=j[c],f.unscaledValue>=g.end.output[0]&&(f.unscaledValue=g.start.output[0]),h[b]=f.unscaledValue,f.unscaledValue+=i[e];d.mulAdd(a),f.value=flock.ugen.lastOutputValue(a,h)},d.onInputChanged(),d},fluid.defaults("flock.ugen.phasor",{rate:"control",inputs:{start:0,end:1,reset:0,step:.1,trigger:0,mul:null,add:null},ugenOptions:{model:{unscaledValue:void 0,value:0},strideInputs:["trigger","step"]}})}();var fluid=fluid||require("infusion"),flock=fluid.registerNamespace("flock");!function(){"use strict";var a=flock.requireModule("webarraymath","Filter");flock.ugen.lag=function(a,b,c){var d=flock.ugen(a,b,c);return d.gen=function(a){var b,c,e,f,g=d.model,h=d.output,i=d.inputs,j=i.time.output[0],k=i.source.output,l=g.prevSamp,m=g.lagCoef;for(j!==g.prevTime&&(g.prevtime=j,m=g.lagCoef=0===j?0:Math.exp(flock.LOG001/(j*g.sampleRate))),b=c=0;a>b;b++,c+=g.strides.source)e=k[c],f=e+m*(l-e),h[b]=l=f;g.prevSamp=l,d.mulAdd(a)},d.onInputChanged(),d},fluid.defaults("flock.ugen.lag",{rate:"audio",inputs:{source:null,time:.1},ugenOptions:{strideInputs:["source"],model:{prevSamp:0,lagCoef:0,prevTime:0}}}),flock.ugen.filter=function(b,c,d){var e=flock.ugen(b,c,d);return e.gen=function(){var a=e.model,b=e.output,c=e.inputs,d=c.q.output[0],f=c.freq.output[0];(a.prevFreq!==f||a.prevQ!==d)&&e.updateCoefficients(a,f,d),e.filterEngine.filter(b,e.inputs.source.output),a.prevQ=d,a.prevFreq=f,a.value=a.unscaledValue=b[b.length-1]},e.init=function(){var b=e.options.recipe,c="string"==typeof b?flock.get(b):b;if(!c)throw new Error("Can't instantiate a flock.ugen.filter() without specifying a filter coefficient recipe.");e.filterEngine=new a(c.sizes.b,c.sizes.a),e.model.coeffs={a:e.filterEngine.a,b:e.filterEngine.b},e.updateCoefficients=flock.get(c,e.options.type),e.onInputChanged()},e.init(),e},fluid.defaults("flock.ugen.filter",{rate:"audio",inputs:{freq:440,q:1,source:null}}),flock.ugen.filter.biquad=function(a,b,c){var d=flock.ugen(a,b,c);return d.gen=function(a){var b,c,e=d.model,f=d.inputs,g=d.output,h=e.coeffs,i=f.freq.output[0],j=f.q.output[0],k=f.source.output;for((e.prevFreq!==i||e.prevQ!==j)&&d.updateCoefficients(e,i,j),b=0;a>b;b++)c=k[b]-h.a[0]*e.d0-h.a[1]*e.d1,g[b]=h.b[0]*c+h.b[1]*e.d0+h.b[2]*e.d1,e.d1=e.d0,e.d0=c;e.prevQ=j,e.prevFreq=i,e.value=e.unscaledValue=flock.ugen.lastOutputValue(a,g)},d.onInputChanged=function(){var a=d.options.type;d.updateCoefficients="string"==typeof a?flock.get(a):a},d.init=function(){d.model.d0=0,d.model.d1=0,d.model.coeffs={a:new Float32Array(2),b:new Float32Array(3)},d.onInputChanged()},d.init(),d},fluid.defaults("flock.ugen.filter.biquad",{inputs:{freq:440,q:1,source:null}}),flock.ugen.filter.biquad.types={hp:{inputDefaults:{freq:440,q:1},options:{type:"flock.coefficients.butterworth.highPass"}},rhp:{inputDefaults:{freq:440,q:1},options:{type:"flock.coefficients.rbj.highPass"}},lp:{inputDefaults:{freq:440,q:1},options:{type:"flock.coefficients.butterworth.lowPass"}},rlp:{inputDefaults:{freq:440,q:1},options:{type:"flock.coefficients.rbj.lowPass"}},bp:{inputDefaults:{freq:440,q:4},options:{type:"flock.coefficients.butterworth.bandPass"}},br:{inputDefaults:{freq:440,q:1},options:{type:"flock.coefficients.butterworth.bandReject"}}},flock.aliasUGens("flock.ugen.filter.biquad",flock.ugen.filter.biquad.types),flock.coefficients={butterworth:{sizes:{a:2,b:3},lowPass:function(a,b){var c=a.coeffs,d=1/Math.tan(Math.PI*b/a.sampleRate),e=d*d,f=flock.ROOT2*d,g=1/(1+f+e);c.b[0]=g,c.b[1]=2*g,c.b[2]=g,c.a[0]=2*(1-e)*g,c.a[1]=(1-f+e)*g},highPass:function(a,b){var c=a.coeffs,d=Math.tan(Math.PI*b/a.sampleRate);d===1/0&&(d=0);var e=d*d,f=flock.ROOT2*d,g=1/(1+f+e);c.b[0]=g,c.b[1]=-2*g,c.b[2]=g,c.a[0]=2*(e-1)*g,c.a[1]=(1-f+e)*g},bandPass:function(a,b,c){var d=a.coeffs,e=b/c,f=1/Math.tan(Math.PI*e/a.sampleRate),g=2*Math.cos(flock.TWOPI*b/a.sampleRate),h=1/(1+f);d.b[0]=h,d.b[1]=0,d.b[2]=-h,d.a[0]=-(f*g*h),d.a[1]=h*(f-1)},bandReject:function(a,b,c){var d=a.coeffs,e=b/c,f=Math.tan(Math.PI*e/a.sampleRate),g=2*Math.cos(flock.TWOPI*b/a.sampleRate),h=1/(1+f),i=-g*h;d.b[0]=h,d.b[1]=i,d.b[2]=h,d.a[0]=i,d.a[1]=(1-f)*h}},rbj:{sizes:{a:2,b:3},lowPass:function(a,b,c){var d=a.coeffs,e=flock.TWOPI*b/a.sampleRate,f=Math.cos(e),g=Math.sin(e),h=g/(2*c),i=1-f,j=1+h,k=i/2/j;d.b[0]=k,d.b[1]=i/j,d.b[2]=k,d.a[0]=-2*f/j,d.a[1]=(1-h)/j},highPass:function(a,b,c){var d=a.coeffs,e=flock.TWOPI*b/a.sampleRate,f=Math.cos(e),g=Math.sin(e),h=g/(2*c),i=1+f,j=1+h,k=i/2/j;d.b[0]=k,d.b[1]=-i/j,d.b[2]=k,d.a[0]=-2*f/j,d.a[1]=(1-h)/j},bandPass:function(a,b,c){var d=a.coeffs,e=flock.TWOPI*b/a.sampleRate,f=Math.cos(e),g=Math.sin(e),h=g/(2*c),i=1+h,j=c*h;d.b[0]=j/i,d.b[1]=0,d.b[2]=-j/i,d.a[0]=-2*f/i,d.a[1]=(1-h)/i},bandReject:function(a,b,c){var d=a.coeffs,e=flock.TWOPI*b/a.sampleRate,f=Math.cos(e),g=Math.sin(e),h=g/(2*c),i=1+h,j=1/i,k=-2*f/i;d.b[0]=j,d.b[1]=k,d.b[2]=j,d.a[0]=k,d.a[1]=(1-h)/i}}},flock.ugen.filter.moog=function(a,b,c){var d=flock.ugen(a,b,c);return d.gen=function(a){var b,c,e,f,g,h,i,j=d.model,k=d.inputs,l=d.output,m=k.source.output,n=j.strides.source,o=k.resonance.output,p=j.strides.resonance,q=k.cutoff.output,r=j.strides.cutoff,s=j.f,t=j.fSq,u=j.fSqSq,v=j.oneMinusF,w=j.fb;for(b=c=e=f=0;a>b;b++,c+=n,e+=p,f+=r)g=q[f],h=o[e],g!==j.prevCutoff&&(g>j.nyquistRate&&(g=j.nyquistRate),s=j.f=g/j.nyquistRate*1.16,t=j.fSq=s*s,u=j.fSqSq=t*t,v=j.oneMinusF=1-s,j.prevRes=void 0),h!==j.prevRes&&(h>4?h=4:0>h&&(h=0),w=j.fb=h*(1-.15*t)),i=m[c]-j.out4*w,i*=.35013*u,j.out1=i+.3*j.in1+v*j.out1,j.in1=i,j.out2=j.out1+.3*j.in2+v*j.out2,j.in2=j.out1,j.out3=j.out2+.3*j.in3+v*j.out3,j.in3=j.out2,j.out4=j.out3+.3*j.in4+v*j.out4,j.in4=j.out3,l[b]=j.out4;j.unscaledValue=j.out4,d.mulAdd(a),j.value=flock.ugen.lastOutputValue(a,l)},d.onInputChanged(),d},fluid.defaults("flock.ugen.filter.moog",{rate:"audio",inputs:{cutoff:3e3,resonance:3.99,source:null},ugenOptions:{model:{in1:0,in2:0,in3:0,in4:0,out1:0,out2:0,out3:0,out4:0,prevCutoff:void 0,prevResonance:void 0,f:void 0,fSq:void 0,fSqSq:void 0,oneMinusF:void 0,fb:void 0,unscaledValue:0,value:0},strideInputs:["source","cutoff","resonance"]}}),flock.ugen.delay=function(a,b,c){var d=flock.ugen(a,b,c);return d.gen=function(a){var b,c,e=d.model,f=d.inputs,g=d.output,h=f.source.output,i=f.time.output[0],j=d.delayBuffer;for(i!==e.time&&(e.time=i,e.delaySamps=i*d.model.sampleRate),b=0;a>b;b++)e.pos>=e.delaySamps&&(e.pos=0),g[b]=c=j[e.pos],j[e.pos]=h[b],e.pos++;e.unscaledValue=c,d.mulAdd(a),e.value=flock.ugen.lastOutputValue(a,g)},d.onInputChanged=function(a){if(flock.onMulAddInputChanged(d),!a||"maxTime"===a){var b=d.model.sampleRate*d.inputs.maxTime.output[0];d.delayBuffer=new Float32Array(b)}},d.onInputChanged(),d},fluid.defaults("flock.ugen.delay",{rate:"audio",inputs:{maxTime:1,time:1,source:null},ugenOptions:{model:{pos:0,unscaledValue:0,value:0}}}),flock.ugen.delay1=function(a,b,c){var d=flock.ugen(a,b,c);return d.gen=function(a){var b,c,e=d.model,f=d.inputs,g=d.output,h=f.source.output,i=e.prevVal;for(b=0;a>b;b++)g[b]=c=i,i=h[b];e.prevVal=i,e.unscaledValue=c,d.mulAdd(a),e.value=flock.ugen.lastOutputValue(a,g)},d.onInputChanged=function(){flock.onMulAddInputChanged(d)},d.onInputChanged(),d},fluid.defaults("flock.ugen.delay1",{rate:"audio",inputs:{source:null},ugenOptions:{model:{prevVal:0,unscaledValue:0,value:0}}}),flock.ugen.freeverb=function(a,b,c){var d=flock.ugen(a,b,c);return d.tunings=d.options.tunings,d.allpassTunings=d.options.allpassTunings,d.gen=function(a){var b,c,e,f=d.model,g=d.inputs,h=d.output,i=g.source.output,j=g.mix.output[0],k=1-j,l=g.room.output[0],m=.28*l+.7,n=g.damp.output[0],o=.4*n,p=1-o;for(b=0;a>b;b++){var q=i[b],r=.015*q;for(c=0;c<d.buffers_a.length;c++)++d.bufferindices_a[c]===d.allpassTunings[c]&&(d.bufferindices_a[c]=0),d.readsamp_a[c]=d.buffers_a[c][d.bufferindices_a[c]];for(c=0;c<d.buffers_c.length;c++){++d.bufferindices_c[c]===d.tunings[c]&&(d.bufferindices_c[c]=0);var s=d.bufferindices_c[c],t=d.buffers_c[c][s];d.filterx_c[c]=p*d.filtery_c[c]+o*d.filterx_c[c],d.buffers_c[c][s]=r+m*d.filterx_c[c],d.filtery_c[c]=t}var u=d.filtery_c[6]+d.filtery_c[7];d.buffers_a[3][d.bufferindices_a[3]]=.5*d.filterx_a[3]+d.filtery_c[0]+(d.filtery_c[1]+d.filtery_c[2])+(d.filtery_c[3]+d.filtery_c[4]+(d.filtery_c[5]+u)),d.filterx_a[3]=d.readsamp_a[3],d.filtery_a[3]=d.filterx_a[3]-(d.filtery_c[0]+d.filtery_c[1]+(d.filtery_c[2]+d.filtery_c[3])+(d.filtery_c[4]+d.filtery_c[5]+u)),d.buffers_a[2][d.bufferindices_a[2]]=.5*d.filterx_a[2]+d.filtery_a[3],d.filterx_a[2]=d.readsamp_a[2],d.filtery_a[2]=d.filterx_a[2]-d.filtery_a[3],d.buffers_a[1][d.bufferindices_a[1]]=.5*d.filterx_a[1]+d.filtery_a[2],d.filterx_a[1]=d.readsamp_a[1],d.filtery_a[1]=d.filterx_a[1]-d.filtery_a[2],d.buffers_a[0][d.bufferindices_a[0]]=.5*d.filterx_a[0]+d.filtery_a[1],d.filterx_a[0]=d.readsamp_a[0],d.filtery_a[0]=d.filterx_a[0]-d.filtery_a[1],e=k*q+j*d.filtery_a[0],h[b]=e}f.unscaledValue=e,d.mulAdd(a),f.value=flock.ugen.lastOutputValue(a,h)},d.initDelayLines=function(){d.buffers_c=new Array(8),d.bufferindices_c=new Int32Array(8),d.filterx_c=new Float32Array(8),d.filtery_c=new Float32Array(8);var a,b,c=d.model.spread;for(a=0;a<d.buffers_c.length;a++)for(d.buffers_c[a]=new Float32Array(d.tunings[a]+c),d.bufferindices_c[a]=0,d.filterx_c[a]=0,d.filtery_c[a]=0,b=0;b<d.tunings[a]+c;b++)d.buffers_c[a][b]=0;for(d.buffers_a=new Array(4),d.bufferindices_a=new Int32Array(4),d.filterx_a=new Float32Array(4),d.filtery_a=new Float32Array(4),d.readsamp_a=new Float32Array(4),a=0;a<d.buffers_a.length;a++){for(d.bufferindices_a[a]=0,d.filterx_a[a]=0,d.filtery_a[a]=0,d.readsamp_a[a]=0,b=0;b<d.allpassTunings.length;b++)d.allpassTunings[b]+=c;for(d.buffers_a[a]=new Float32Array(d.allpassTunings[a]),b=0;b<d.allpassTunings[a];b++)d.buffers_a[a][b]=0}},d.init=function(){d.initDelayLines(),d.onInputChanged()},d.init(),d},fluid.defaults("flock.ugen.freeverb",{rate:"audio",inputs:{source:null,mix:.33,room:.5,damp:.5},ugenOptions:{model:{spread:0,unscaledValue:0,value:0},tunings:[1116,1188,1277,1356,1422,1491,1557,1617],allpassTunings:[556,441,341,225]}}),flock.ugen.decay=function(a,b,c){var d=flock.ugen(a,b,c);return d.gen=function(a){var b,c,e=d.model,f=d.inputs,g=d.output,h=f.source.output,i=f.time.output[0];if(i!==e.time&&(e.time=i,e.coeff=0===i?0:Math.exp(flock.LOG001/(i*d.model.sampleRate))),0===e.coeff)for(b=0;a>b;b++)g[b]=c=h[b];else for(b=0;a>b;b++)e.lastSamp=h[b]+e.coeff*e.lastSamp,g[b]=c=e.lastSamp;e.unscaledValue=c,d.mulAdd(a),e.value=flock.ugen.lastOutputValue(a,g)},d.onInputChanged(),d},fluid.defaults("flock.ugen.decay",{rate:"audio",inputs:{source:null,time:1},ugenOptions:{model:{time:0,lastSamp:0,coeff:0,value:0}}})}();var fluid=fluid||require("infusion"),flock=fluid.registerNamespace("flock");!function(){"use strict";flock.ugen.gate=function(a,b,c){var d=flock.ugen(a,b,c);return d.gen=function(a){var b,c,e,f,g=d.model,h=g.strides,i=d.output,j=d.inputs,k=j.source.output,l=j.sideChain.output,m=h.sideChain,n=j.threshold.output,o=h.threshold,p=d.options.holdLastValue,q=g.lastValue;for(b=c=e=0;a>b;b++,c+=m,e+=o)l[c]>=n[e]?i[b]=f=q=k[b]:i[b]=f=p?q:0;g.lastValue=q,g.unscaledValue=f,d.mulAdd(a),g.value=flock.ugen.lastOutputValue(a,i)},d.onInputChanged=function(){d.inputs.sideChain||(d.inputs.sideChain=d.inputs.source),flock.onMulAddInputChanged(d),d.calculateStrides()},d.onInputChanged(),d},fluid.defaults("flock.ugen.gate",{rate:"audio",inputs:{source:null,sideChain:null,threshold:Number.MIN_VALUE,mul:null,add:null},ugenOptions:{model:{unscaledValue:0,value:0,lastValue:0},holdLastValue:!1,strideInputs:["sideChain","threshold"]}}),flock.ugen.timedGate=function(a,b,c){var d=flock.ugen(a,b,c);return d.gen=function(a){var b,c,e,f,g=d.model,h=d.output,i=d.inputs.trigger.output,j=d.inputs.duration.output[0];for(j!==g.duration&&(g.duration=j,g.durationSamps=Math.floor(j*g.sampleRate)),c=e=0;a>c;c++,e+=g.strides.trigger)b=i[e],b>0&&g.prevTrigger<=0?(f=d.options.resetOnTrigger&&g.sampsRemaining>0?0:1,g.sampsRemaining=g.durationSamps):f=g.sampsRemaining>0?1:0,h[c]=f,g.sampsRemaining--,g.prevTrigger=b;g.unscaledValue=f,d.mulAdd(a),g.value=flock.ugen.lastOutputValue(a,h)},d.init=function(){d.onInputChanged()},d.init(),d},fluid.defaults("flock.ugen.timedGate",{rate:"audio",inputs:{trigger:0,duration:1},ugenOptions:{model:{unscaledValue:0,value:0,prevTrigger:0,sampsRemaining:0,durationSamps:0,duration:0},resetOnTrigger:!0,strideInputs:["trigger"]}}),flock.ugen.latch=function(a,b,c){var d=flock.ugen(a,b,c);return d.arGen=function(a){var b,c,e,f,g=d.model,h=d.inputs,i=h.source.output,j=h.trigger,k=g.strides.source,l=d.output;for(void 0===g.holdVal&&(g.holdVal=i[0]),b=0,c=0;a>b;b++,c+=k)e=j.output[b],l[b]=f=e>0&&g.prevTrig<=0?g.holdVal=i[c]:g.holdVal,g.prevTrig=e;g.unscaledValue=f,d.mulAdd(a),g.value=flock.ugen.lastOutputValue(a,l)},d.krGen=function(a){var b,c=d.model,e=d.output,f=d.inputs.trigger.output[0];for((void 0===c.holdVal||f>0&&c.prevTrig<=0)&&(c.holdVal=d.inputs.source.output[0]),c.prevTrig=f,b=0;a>b;b++)e[b]=c.holdVal;c.unscaledValue=c.holdVal,d.mulAdd(a),c.value=flock.ugen.lastOutputValue(a,e)},d.onInputChanged=function(){d.calculateStrides(),d.gen=d.inputs.trigger.rate===flock.rates.AUDIO?d.arGen:d.krGen,flock.onMulAddInputChanged(d)},d.onInputChanged(),d},fluid.defaults("flock.ugen.latch",{rate:"audio",inputs:{source:null,trigger:0,mul:null,add:null},ugenOptions:{strideInputs:["source"],model:{prevTrig:0,unscaledValue:0,value:0}}})}();var fluid=fluid||require("infusion"),flock=fluid.registerNamespace("flock");!function(){"use strict";flock.ugen.triggerGrains=function(a,b,c){var d=flock.ugen(a,b,c);return d.gen=function(a){var b,c,e,f,g,h,i,j=d.model,k=d.inputs,l=d.output,m=k.channel.output[0],n=d.buffer.data.channels[m],o=d.buffer.format.sampleRate,p=k.dur.output[0],q=k.amp.output,r=k.centerPos.output,s=k.trigger.output,t=k.speed.output,u=d.options.grainEnv,v=a-1,w=0,x=0,y=0,z=0;for(b=0;a>b;b++){if(s[x]>0&&j.prevTrigger<=0&&j.activeGrains.length<j.maxNumGrains){for(f=j.freeGrains.pop(),f.numSamps=j.sampleRate*p,f.centerIdx=f.numSamps/2*j.stepSize,f.envScale=d.options.grainEnv.length/f.numSamps,f.sampIdx=0,f.amp=q[y],g=r[w]*o-f.centerIdx;0>g;)g+=n.length;f.readPos=g,f.writePos=b,f.speed=t[z],j.activeGrains.push(f)}j.prevTrigger=s[x],l[b]=0,w+=j.strides.centerPos,x+=j.strides.trigger,y+=j.strides.amp,z+=j.strides.speed}for(c=0;c<j.activeGrains.length;){for(f=j.activeGrains[c],e=f.writePos;e<Math.min(e+(f.numSamps-f.sampIdx),a);e++)h=d.interpolate(f.readPos,n),i=flock.interpolate.linear(f.sampIdx*f.envScale,u),l[e]+=h*i*f.amp,f.readPos=(f.readPos+j.stepSize*f.speed)%n.length,f.sampIdx++;f.sampIdx>=f.numSamps?(j.freeGrains.push(f),j.activeGrains.splice(c,1)):(c++,f.writePos=e%a)}j.unscaledValue=l[v],d.mulAdd(a),j.value=l[v]},d.onBufferReady=function(){var a=d.model;a.stepSize=d.buffer.format.sampleRate/a.sampleRate},d.onInputChanged=function(a){d.onBufferInputChanged(a),d.calculateStrides(),flock.onMulAddInputChanged(d)},d.allocateGrains=function(a){a=a||d.model.maxNumGrains;for(var b=0;a>b;b++)d.model.freeGrains.push({numSamps:0,centerIdx:0,envScale:0,sampIdx:0,amp:0,readPos:0,writePos:0,speed:0})},d.init=function(){flock.ugen.buffer(d),d.allocateGrains(),d.initBuffer(),d.onInputChanged()},d.init(),d},fluid.defaults("flock.ugen.triggerGrains",{rate:"audio",inputs:{centerPos:0,channel:0,amp:1,dur:.1,speed:1,trigger:0,buffer:null,mul:null,add:null},ugenOptions:{grainEnv:flock.fillTable(8192,flock.tableGenerators.hann),model:{unscaledValue:0,value:0,maxNumGrains:512,activeGrains:[],freeGrains:[],env:null,strides:{}},strideInputs:["centerPos","trigger","amp","speed"],interpolation:"cubic"}}),flock.ugen.granulator=function(a,b,c){var d=flock.ugen(a,b,c);return d.gen=function(a){var b,c,e,f,g,h,i,j,k=d.model,l=d.options,m=d.inputs,n=d.output,o=d.delayLine,p=m.grainDur.output[0],q=m.delayDur.output[0],r=m.numGrains.output[0],s=m.source.output,t=l.maxDelayDur,u=l.grainEnv;for(k.delayDur!==q&&(k.delayDur=q,q>t&&(q=t),k.delayLength=q*k.sampleRate|0,k.writePos=k.writePos%k.delayLength),k.grainDur!==p&&(k.grainDur=p,k.grainLength=k.sampleRate*k.grainDur|0,k.envScale=u.length/k.grainLength),r=r>l.maxNumGrains?l.maxNumGrains:Math.round(r),b=0;a>b;b++){for(o[k.writePos]=s[b],k.writePos=++k.writePos%k.delayLength,e=0,c=0;r>c;c++)f=k.grainIdx[c],g=k.delayLineIdx[c],f>k.grainLength&&(f=0,g=Math.random()*k.delayLength|0),h=o[g],i=f*k.envScale,j=flock.interpolate.linear(i,u),e+=h*j,k.delayLineIdx[c]=++g%k.delayLength,k.grainIdx[c]=++f;e/=r,n[b]=e}k.unscaledValue=e,d.mulAdd(a),k.value=flock.ugen.lastOutputValue(a,n)},d.initGrains=function(){for(var a=d.model,b=0;b<d.options.maxNumGrains;b++)a.grainIdx[b]=0,a.delayLineIdx[b]=Math.random()*a.delayLength},d.init=function(){var a=d.model,b=d.options,c=b.maxDelayDur*a.sampleRate|0;d.delayLine=new Float32Array(c),a.delayLength=c,a.delayLineIdx=new Uint32Array(b.maxNumGrains),a.grainIdx=new Uint32Array(b.maxNumGrains),d.initGrains(),d.onInputChanged()},d.init(),d},fluid.defaults("flock.ugen.granulator",{rate:"audio",inputs:{source:null,grainDur:.1,delayDur:1,numGrains:5,mul:null,add:null},ugenOptions:{maxNumGrains:512,maxDelayDur:30,grainEnv:flock.fillTable(8192,flock.tableGenerators.sinWindow),model:{unscaledValue:0,value:0,grainLength:0,writePos:0}}})}();var fluid=fluid||require("infusion"),flock=fluid.registerNamespace("flock");!function(){"use strict";flock.ugen.amplitude=function(a,b,c){var d=flock.ugen(a,b,c);return d.gen=function(a){var b,c,e,f=d.model,g=d.inputs.source.output,h=d.output,i=f.attackTime,j=d.inputs.attack.output[0],k=f.releaseTime,l=d.inputs.release.output[0],m=f.prevVal,n=f.attackCoef,o=f.releaseCoef;for(j!==i&&(f.attackTime=j,n=f.attackCoef=0===j?0:Math.exp(flock.LOG01/(j*f.sampleRate))),l!==k&&(f.releaseTime=l,o=f.releaseCoef=0===l?0:Math.exp(flock.LOG01/(l*f.sampleRate))),b=0;a>b;b++)c=Math.abs(g[b]),e=m>c?o:n,h[b]=m=c+(m-c)*e;f.unscaledValue=f.prevVal=m,d.mulAdd(a),f.value=flock.ugen.lastOutputValue(a,h)},d.onInputChanged(),d},fluid.defaults("flock.ugen.amplitude",{rate:"audio",inputs:{source:null,attack:.01,release:.01,mul:null,add:null},ugenOptions:{model:{prevVal:0,unscaledValue:0,value:0}}})}();var fluid=fluid||require("infusion"),flock=fluid.registerNamespace("flock");!function(){"use strict";var a=flock.requireModule("webarraymath","ArrayMath");flock.ugen.math=function(b,c,d){var e=flock.ugen(b,c,d);return e.expandedRight=new Float32Array(e.options.audioSettings.blockSize),e.krSourceKrInputGen=function(){var b=e.model,c=e.activeInput,d=e.inputs[c],f=e.output,g=e.inputs.source.output[0],h=flock.generate(e.expandedRight,d.output[0]);a[c](f,g,h),b.value=b.unscaledValue=f[f.length-1]},e.krSourceArInputGen=function(){var b=e.model,c=e.activeInput,d=e.inputs[c],f=e.output,g=e.inputs.source.output[0],h=d.output;a[c](f,g,h),b.value=b.unscaledValue=f[f.length-1]},e.arSourceKrInputGen=function(){var b=e.model,c=e.activeInput,d=e.inputs[c],f=e.output,g=e.inputs.source.output,h=flock.generate(e.expandedRight,d.output[0]);a[c](f,g,h),b.value=b.unscaledValue=f[f.length-1]},e.arSourceArInputGen=function(){var b=e.model,c=e.activeInput,d=e.inputs[c],f=e.output,g=e.inputs.source.output,h=d.output;a[c](f,g,h),b.value=b.unscaledValue=f[f.length-1]},e.onInputChanged=function(){var a,b,c,d=Object.keys(e.inputs);for(a=0;a<d.length;a++)if(b=d[a],"source"!==b){e.activeInput=b,c="audio"===e.inputs[b].rate,e.gen="audio"===e.inputs.source.rate?c?e.arSourceArInputGen:e.arSourceKrInputGen:c?e.krSourceArInputGen:e.krSourceKrInputGen;break}},e.init=function(){if("undefined"==typeof a)throw new Error("ArrayMath is undefined. Please include webarraymath.js to use the flock.math unit generator.");e.onInputChanged()},e.init(),e},fluid.defaults("flock.ugen.math",{rate:"audio",inputs:{source:null}}),flock.ugen.sum=function(a,b,c){var d=flock.ugen(a,b,c);return d.copyGen=function(a){var b,c=d.model,e=d.output,f=d.inputs.sources.output;for(b=0;a>b;b++)e[b]=f[b];c.value=c.unscaledValue=flock.ugen.lastOutputValue(a,e)},d.sumGen=function(a){var b,c,e,f=d.model,g=d.inputs.sources,h=d.output;for(b=0;a>b;b++){for(e=0,c=0;c<g.length;c++)e+=g[c].output[b];h[b]=e}f.value=f.unscaledValue=flock.ugen.lastOutputValue(a,h)},d.onInputChanged=function(){"number"==typeof d.inputs.sources.length?d.gen=d.sumGen:d.gen=d.copyGen},d.onInputChanged(),d},fluid.defaults("flock.ugen.sum",{rate:"audio",inputs:{sources:null}})}();var fluid=fluid||require("infusion"),flock=fluid.registerNamespace("flock");!function(){"use strict";flock.ugen.midiFreq=function(a,b,c){var d=flock.ugen(a,b,c);return d.gen=function(a){var b,c,e,f=d.model,g=f.a4,h=g.freq,i=g.noteNum,j=f.notesPerOctave,k=d.inputs.note.output,l=d.output;for(b=0,c=0;a>b;b++,c+=f.strides.note)l[b]=e=flock.midiFreq(k[c],h,i,j);f.unscaledValue=e,d.mulAdd(a),f.value=flock.ugen.lastOutputValue(a,l)},d.init=function(){d.model.octaveScale=1/d.model.notesPerOctave,d.onInputChanged()},d.init(),d},fluid.defaults("flock.ugen.midiFreq",{rate:"control",inputs:{note:69},ugenOptions:{model:{unscaledValue:0,value:0,a4:{noteNum:69,freq:440},notesPerOctave:12},strideInputs:["note"]}}),flock.ugen.midiAmp=function(a,b,c){var d=flock.ugen(a,b,c);return d.gen=function(a){var b,c,e,f=d.model,g=d.inputs.velocity.output,h=d.output;for(b=0,c=0;a>b;b++,c+=f.strides.velocity)h[b]=e=g[c]/127;f.unscaledValue=e,d.mulAdd(a),f.value=flock.ugen.lastOutputValue(a,h)},d.init=function(){d.onInputChanged()},d.init(),d},fluid.defaults("flock.ugen.midiAmp",{rate:"control",inputs:{velocity:0},ugenOptions:{model:{unscaledValue:0,value:0},strideInputs:["velocity"]}})}();var fluid=fluid||require("infusion"),flock=fluid.registerNamespace("flock");!function(){"use strict";flock.ugen.pan2=function(a,b,c){var d=flock.ugen(a,b,c);return d.gen=function(a){var b,c,e,f,g=d.model,h=d.output,i=h[0],j=h[1],k=d.inputs,l=k.source.output,m=k.pan.output;for(b=0,c=0;a>b;b++,c+=g.strides.pan)e=l[b],f=.5*m[c]+.5,j[b]=e*Math.sin(f*flock.HALFPI),i[b]=e*Math.cos(f*flock.HALFPI);var n=a-1;g.value[0]=h[0][n],g.value[1]=h[1][n]},d.init=function(){d.onInputChanged(),d.model.unscaledValue=d.model.value},d.init(),d},fluid.defaults("flock.ugen.pan2",{rate:"audio",inputs:{source:null,pan:0},ugenOptions:{model:{unscaledValue:[0,0],value:[0,0]},tags:["flock.ugen.multiChannelOutput"],strideInputs:["pan"],numOutputs:2}})}();var fluid=fluid||require("infusion"),flock=fluid.registerNamespace("flock");!function(){"use strict";flock.ugen.osc=function(a,b,c){var d=flock.ugen(a,b,c);return d.gen=function(a){var b,c,e,f,g,h=d.model,i=d.inputs,j=i.freq.output,k=i.phase.output,l=i.table,m=h.tableLen,n=h.tableIncHz,o=h.tableIncRad,p=d.output,q=h.phase;for(b=0,c=0,e=0;a>b;b++,c+=h.strides.phase,e+=h.strides.freq)f=q+k[c]*o,f>=m?f-=m:0>f&&(f+=m),p[b]=g=d.interpolate(f,l),q+=j[e]*n,q>=m?q-=m:0>q&&(q+=m);h.phase=q,h.unscaledValue=g,d.mulAdd(a),h.value=flock.ugen.lastOutputValue(a,p)},d.onInputChanged=function(a){if(flock.ugen.osc.onInputChanged(d),!a||"table"===a){var b=d.model,c=d.inputs.table;c.length<1&&(c=d.inputs.table=flock.ugen.osc.emptyTable),b.tableLen=c.length,b.tableIncHz=b.tableLen/b.sampleRate,b.tableIncRad=b.tableLen/flock.TWOPI}},d.onInputChanged(),d},flock.ugen.osc.emptyTable=new Float32Array([0,0,0]),flock.ugen.osc.onInputChanged=function(a){a.calculateStrides(),flock.onMulAddInputChanged(a)},fluid.defaults("flock.ugen.osc",{rate:"audio",inputs:{freq:440,phase:0,table:[],mul:null,add:null},ugenOptions:{interpolation:"linear",model:{phase:0,unscaledValue:0,value:0},strideInputs:["freq","phase"]},tableSize:8192}),flock.ugen.osc.define=function(a,b){var c=a.lastIndexOf("."),d=a.substring(0,c),e=a.substring(c+1),f=flock.get(d);f[e]=function(a,c,d){var e=fluid.defaults("flock.ugen.osc"),f=fluid.merge(null,e,d),g=f.tableSize;return a.table=flock.fillTable(g,b),flock.ugen.osc(a,c,d)},fluid.defaults(a,fluid.defaults("flock.ugen.osc"))},flock.ugen.osc.define("flock.ugen.sinOsc",flock.tableGenerators.sin),flock.ugen.osc.define("flock.ugen.triOsc",flock.tableGenerators.tri),flock.ugen.osc.define("flock.ugen.sawOsc",flock.tableGenerators.saw),
flock.ugen.osc.define("flock.ugen.squareOsc",flock.tableGenerators.square),flock.ugen.sin=function(a,b,c){var d=flock.ugen(a,b,c);return d.gen=function(a){var b,c,e,f,g=d.model,h=d.inputs.freq.output,i=d.inputs.phase.output,j=d.output,k=g.phase,l=g.sampleRate;for(b=0,c=0,e=0;a>b;b++,c+=g.strides.phase,e+=g.strides.freq)j[b]=f=Math.sin(k+i[c]),k+=h[e]/l*flock.TWOPI;g.phase=k,g.unscaledValue=f,d.mulAdd(a),g.value=flock.ugen.lastOutputValue(a,j)},d.onInputChanged=function(){flock.ugen.osc.onInputChanged(d)},d.onInputChanged(),d},fluid.defaults("flock.ugen.sin",{rate:"audio",inputs:{freq:440,phase:0,mul:null,add:null},ugenOptions:{model:{phase:0,unscaledValue:0,value:0},strideInputs:["freq","phase"]}}),flock.ugen.lfSaw=function(a,b,c){var d=flock.ugen(a,b,c);return d.gen=function(a){var b,c,e,f=d.model,g=d.inputs.freq.output,h=d.output,i=f.scale,j=d.inputs.phase.output[0],k=f.phase;for(b=0,c=0;a>b;b++,c+=f.strides.freq)h[b]=e=k+j,k+=g[c]*i,k>=1?k-=2:-1>=k&&(k+=2);f.phase=k,f.unscaledValue=e,d.mulAdd(a),f.value=flock.ugen.lastOutputValue(a,h)},d.onInputChanged=function(){var a=d.model;a.freqInc=d.inputs.freq.rate===flock.rates.AUDIO?1:0,a.phase=0,d.calculateStrides(),flock.onMulAddInputChanged(d)},d.init=function(){d.model.scale=2*(1/d.options.sampleRate),d.onInputChanged()},d.init(),d},fluid.defaults("flock.ugen.lfSaw",{rate:"audio",inputs:{freq:440,phase:0,mul:null,add:null},ugenOptions:{model:{phase:0,freqInc:1,unscaledValue:0,value:0},strideInputs:["freq"]}}),flock.ugen.lfPulse=function(a,b,c){var d=flock.ugen(a,b,c);return d.gen=function(a){var b,c,e,f=d.inputs,g=d.model,h=f.freq.output,i=g.freqInc,j=f.width.output[0],k=d.output,l=g.scale,m=void 0!==g.phase?g.phase:f.phase.output[0];for(b=0,c=0;a>b;b++,c+=i)m>=1?(m-=1,k[b]=e=.5>j?1:-1):k[b]=e=j>m?1:-1,m+=h[c]*l;g.phase=m,g.unscaledValue=e,d.mulAdd(a),g.value=flock.ugen.lastOutputValue(a,k)},d.onInputChanged=function(){d.model.freqInc=d.inputs.freq.rate===flock.rates.AUDIO?1:0,flock.onMulAddInputChanged(d)},d.init=function(){d.model.scale=1/d.options.sampleRate,d.onInputChanged()},d.init(),d},fluid.defaults("flock.ugen.lfPulse",{rate:"audio",inputs:{freq:440,phase:0,width:.5,mul:null,add:null},ugenOptions:{model:{phase:0,freqInc:1,unscaledValue:0,value:0}}}),flock.ugen.impulse=function(a,b,c){var d=flock.ugen(a,b,c);return d.gen=function(a){var b,c,e,f=d.inputs,g=d.model,h=d.output,i=f.freq.output,j=g.strides.freq,k=f.phase.output[0],l=g.phase,m=g.scale;for(l+=k,b=0,c=0;a>b;b++,c+=j)l>=1?(l-=1,e=1):e=0,h[b]=e,l+=i[c]*m;g.phase=l-k,g.unscaledValue=e,d.mulAdd(a),g.value=flock.ugen.lastOutputValue(a,h)},d.onInputChanged=function(){d.calculateStrides(),flock.onMulAddInputChanged(d)},d.init=function(){d.model.scale=1/d.model.sampleRate,d.onInputChanged()},d.init(),d},fluid.defaults("flock.ugen.impulse",{rate:"audio",inputs:{freq:440,phase:0,mul:null,add:null},ugenOptions:{model:{phase:0,scale:0,unscaledValue:0,value:0},strideInputs:["freq"]}})}();var fluid=fluid||require("infusion"),flock=fluid.registerNamespace("flock");!function(){"use strict";var a=flock.requireModule("Random");flock.ugen.dust=function(a,b,c){var d=flock.ugen(a,b,c);return d.gen=function(b){var c,e,f,g,h,i=d.model,j=d.output,k=a.density.output[0];for(k!==i.density?(i.density=k,c=i.threshold=k*i.sampleDur,e=i.scale=c>0?1/c:0):(c=i.threshold,e=i.scale),h=0;b>h;h++)f=Math.random(),g=c>f?f*e:0,j[h]=g;i.unscaledValue=g,d.mulAdd(b),i.value=flock.ugen.lastOutputValue(b,j)},d.onInputChanged(),d},fluid.defaults("flock.ugen.dust",{rate:"audio",inputs:{density:1,mul:null,add:null},ugenOptions:{model:{density:0,scale:0,threshold:0,unscaledValue:0,value:0}}}),flock.ugen.whiteNoise=function(a,b,c){var d=flock.ugen(a,b,c);return d.gen=function(a){var b,c,e=d.model,f=d.output;for(b=0;a>b;b++)f[b]=c=Math.random();e.unscaledValue=c,d.mulAdd(a),e.value=flock.ugen.lastOutputValue(a,f)},d.onInputChanged(),d},fluid.defaults("flock.ugen.whiteNoise",{rate:"audio",inputs:{mul:null,add:null}}),flock.ugen.pinkNoise=function(a,b,c){var d=flock.ugen(a,b,c);return d.gen=function(a){var b,c,e,f,g=d.model,h=g.state,i=d.a,j=d.p,k=g.offset,l=d.output;for(b=0;a>b;b++){for(f=0,c=0;c<h.length;c++)e=Math.random(),h[c]=j[c]*(h[c]-e)+e,f+=i[c]*h[c];f=2*f-k,l[b]=f}g.unscaledValue=f,d.mulAdd(a),g.value=flock.ugen.lastOutputValue(a,l)},d.init=function(){d.a=new Float32Array(d.options.coeffs.a),d.p=new Float32Array(d.options.coeffs.p),d.model.state=new Float32Array(d.a.length);for(var a=0;a<d.a.length;a++)d.model.offset+=d.a[a];d.onInputChanged()},d.init(),d},fluid.defaults("flock.ugen.pinkNoise",{rate:"audio",inputs:{mul:null,add:null},ugenOptions:{model:{state:0,unscaledValue:0,value:0,offset:0},coeffs:{a:[.02109238,.07113478,.68873558],p:[.319,.7756,.9613]}}}),flock.ugen.lfNoise=function(a,b,c){var d=flock.ugen(a,b,c);return d.gen=function(b){var c,e,f=d.model,g=a.freq.output[0],h=b,i=d.output,j=0;g=g>.001?g:.001;do for(f.counter<=0&&(f.counter=f.sampleRate/g,f.counter=f.counter>1?f.counter:1,"linear"===d.options.interpolation?(f.start=f.unscaledValue=f.end,f.end=Math.random(),f.ramp=f.ramp=(f.end-f.start)/f.counter):(f.start=f.unscaledValue=Math.random(),f.ramp=0)),c=h<f.counter?h:f.counter,h-=c,f.counter-=c,e=0;c>e;e++)i[j]=f.unscaledValue,f.unscaledValue+=f.ramp,j++;while(h);d.mulAdd(b),f.value=flock.ugen.lastOutputValue(b,i)},d.input=function(){d.model.end=Math.random(),d.onInputChanged()},d.input(),d},fluid.defaults("flock.ugen.lfNoise",{rate:"audio",inputs:{freq:440,mul:null,add:null},ugenOptions:{model:{counter:0,level:0,unscaledValue:0,value:0}}}),flock.ugen.random=function(b,c,d){var e=flock.ugen(b,c,d);return e.gen=function(a){var b,c,d=e.model,f=e.generator,g=e.output;for(b=0;a>b;b++)g[b]=c=f.uniform(-1,1);d.unscaledValue=c,e.mulAdd(a),d.value=flock.ugen.lastOutputValue(a,g)},e.onInputChanged=function(a){"seed"===a&&e.initGenerator(),flock.onMulAddInputChanged(e)},e.initGenerator=function(){var b=e.inputs.seed;e.generator=b?new a(b):new a},e.init=function(){e.initGenerator(),e.calculateStrides(),e.onInputChanged()},e.init(),e},fluid.defaults("flock.ugen.random",{rate:"audio",inputs:{seed:null,mul:null,add:null}}),flock.ugen.random.exponential=function(a,b,c){var d=flock.ugen.random(a,b,c);return d.gen=function(a){var b,c,e,f=d.model,g=d.generator,h=d.output,i=d.inputs.lambda.output,j=d.model.strides.lambda;for(b=c=0;a>b;b++,c+=j)h[b]=e=g.exponential(i[c]);f.unscaledValue=e,d.mulAdd(a),f.value=flock.ugen.lastOutputValue(a,h)},d},fluid.defaults("flock.ugen.random.exponential",{rate:"audio",inputs:{seed:null,lambda:1,mul:null,add:null},ugenOptions:{strideInputs:["lambda"]}}),flock.ugen.random.gamma=function(a,b,c){var d=flock.ugen.random(a,b,c);return d.gen=function(a){var b,c,e,f,g=d.model,h=d.inputs,i=d.generator,j=d.output,k=g.strides.alpha,l=h.alpha.output,m=g.strides.beta,n=h.beta.output;for(b=c=e=0;a>b;b++,c+=k,e+=m)j[b]=f=i.gamma(l[c],n[e]);g.unscaledValue=f,d.mulAdd(a),g.value=flock.ugen.lastOutputValue(a,j)},d},fluid.defaults("flock.ugen.random.gamma",{rate:"audio",inputs:{seed:null,alpha:1,beta:2,mul:null,add:null},ugenOptions:{strideInputs:["alpha","beta"]}}),flock.ugen.random.normal=function(a,b,c){var d=flock.ugen.random(a,b,c);return d.gen=function(a){var b,c,e,f,g=d.model,h=d.output,i=d.inputs,j=d.generator,k=g.strides.mu,l=i.mu.output,m=g.strides.sigma,n=i.sigma.output;for(b=c=e=0;a>b;b++,c+=k,e+=m)h[b]=f=j.normal(l[c],n[e]);g.unscaledValue=f,d.mulAdd(a),g.value=flock.ugen.lastOutputValue(a,h)},d},fluid.defaults("flock.ugen.random.normal",{rate:"audio",inputs:{seed:null,mu:0,sigma:1,mul:null,add:null},ugenOptions:{strideInputs:["mu","sigma"]}}),flock.ugen.random.pareto=function(a,b,c){var d=flock.ugen.random(a,b,c);return d.gen=function(a){var b,c,e,f=d.model,g=d.generator,h=d.output,i=d.model.strides.alpha,j=d.inputs.alpha.output;for(b=c=0;a>b;b++,c+=i)h[b]=e=g.pareto(j[c]);f.unscaledValue=e,d.mulAdd(a),f.value=flock.ugen.lastOutputValue(a,h)},d},fluid.defaults("flock.ugen.random.pareto",{rate:"audio",inputs:{seed:null,alpha:5,mul:null,add:null},ugenOptions:{strideInputs:["alpha"]}}),flock.ugen.random.triangular=function(a,b,c){var d=flock.ugen.random(a,b,c);return d.gen=function(a){var b,c,e,f=d.model,g=d.generator,h=d.output,i=d.model.strides.mode,j=d.inputs.mode.output;for(b=c=0;a>b;b++,c+=i)h[b]=e=g.triangular(-1,1,j[c]);f.unscaledValue=e,d.mulAdd(a),f.value=flock.ugen.lastOutputValue(a,h)},d},fluid.defaults("flock.ugen.random.triangular",{rate:"audio",inputs:{seed:null,mode:.5,mul:null,add:null},ugenOptions:{strideInputs:["mode"]}}),flock.ugen.random.weibull=function(a,b,c){var d=flock.ugen.random(a,b,c);return d.gen=function(a){var b,c,e,f,g=d.model,h=d.inputs,i=d.generator,j=d.output,k=g.strides.alpha,l=h.alpha.output,m=g.strides.beta,n=h.beta.output;for(b=c=e=0;a>b;b++,c+=k,e+=m)j[b]=f=i.weibull(l[c],n[e]);g.unscaledValue=f,d.mulAdd(a),g.value=flock.ugen.lastOutputValue(a,j)},d},fluid.defaults("flock.ugen.random.weibull",{rate:"audio",inputs:{seed:null,alpha:1,beta:1,mul:null,add:null},ugenOptions:{strideInputs:["alpha","beta"]}})}();var fluid=fluid||require("infusion"),flock=fluid.registerNamespace("flock");!function(){"use strict";flock.ugen.change=function(a,b,c){var d=flock.ugen(a,b,c);return d.gen=function(a){for(var b,c=d.model,e=d.inputs.initial.output,f=c.strides.initial,g=d.inputs.target.output,h=c.strides.target,i=d.output,j=c.samplesLeft,k=c.crossfadeLevel,l=0,m=0,n=0;a>l;l++,m+=f,n+=h)j>0?(b=e[m],j--):k>0?(b=e[m]*k+g[n]*(1-k),k-=c.crossfadeStepSize):b=g[n],i[l]=b;c.samplesLeft=j,c.crossfadeLevel=k,c.value=c.unscaledValue=b},d.onInputChanged=function(a){var b=d.model,c=d.inputs;"time"!==a&&a||(b.samplesLeft=Math.round(c.time.output[0]*b.sampleRate)),"crossfade"!==a&&a||(b.crossfadeStepSize=1/Math.round(c.crossfade.output[0]*b.sampleRate),b.crossfadeLevel=c.crossfade.output[0]>0?1:0),d.calculateStrides()},d.onInputChanged(),d},fluid.defaults("flock.ugen.change",{rate:"audio",inputs:{initial:0,target:0,time:0,crossfade:0},ugenOptions:{model:{samplesLeft:0,crossfadeStepSize:0,crossfadeLevel:0,unscaledValue:0,value:0},strideInputs:["initial","target"]}}),flock.ugen.sequence=function(a,b,c){var d=flock.ugen(a,b,c);return d.gen=function(a){var b,c,e,f=d.inputs.values,g=d.inputs,h=g.freq.output,i=g.loop.output[0],j=d.model,k=j.scale,l=d.output,m=g.start?Math.round(g.start.output[0]):0,n=g.end?Math.round(g.end.output[0]):f.length;for(void 0===j.unscaledValue&&(b=f[m],j.unscaledValue=void 0===b?0:b),void 0===j.nextIdx&&(j.nextIdx=m),c=0,e=0;a>c;c++,e+=j.strides.freq){if(j.nextIdx>=n){if(!(i>0)){l[c]=j.unscaledValue;continue}j.nextIdx=m}l[c]=j.unscaledValue=f[j.nextIdx],j.phase+=h[e]*k,j.phase>=1&&(j.phase=0,j.nextIdx++)}d.mulAdd(a),j.value=flock.ugen.lastOutputValue(a,l)},d.onInputChanged=function(){d.model.scale=d.rate!==flock.rates.DEMAND?d.model.sampleDur:1,d.inputs.values&&0!==d.inputs.values.length||!d.inputs.list||(flock.log.warn("The 'list' input to flock.ugen.sequence is deprecated. Use 'values' instead."),d.inputs.values=d.inputs.list),d.inputs.values||(d.inputs.values=[]),d.calculateStrides(),flock.onMulAddInputChanged(d)},d.init=function(){d.onInputChanged()},d.init(),d},fluid.defaults("flock.ugen.sequence",{rate:"control",inputs:{start:0,freq:1,loop:0,values:[]},ugenOptions:{model:{unscaledValue:void 0,value:0,phase:0},strideInputs:["freq"]}}),flock.ugen.sequencer=function(a,b,c){var d=flock.ugen(a,b,c);return d.gen=function(a){var b,c,e=d.model,f=d.options,g=f.resetOnNext,h=d.output,i=d.inputs.loop.output[0],j=d.inputs.durations,k=d.inputs.values;for(b=0;a>b;b++)0!==k.length&&0!==j.length?(e.samplesRemaining<=0?e.idx<j.length-1?(e.idx++,c=flock.ugen.sequencer.nextStage(j,k,g,e)):i>0?(e.idx=0,c=flock.ugen.sequencer.nextStage(j,k,g,e)):c=f.holdLastValue?e.unscaledValue:0:(c=k[e.idx],e.samplesRemaining--),h[b]=c):h[b]=c=0;e.unscaledValue=c,d.mulAdd(a),e.value=flock.ugen.lastOutputValue(a,h)},d.onInputChanged=function(a){var b=d.inputs;a&&"durations"!==a||(flock.ugen.sequencer.calcDurationsSamps(b.durations,d.model),flock.ugen.sequencer.failOnMissingInput("durations",d)),a&&"values"!==a||flock.ugen.sequencer.failOnMissingInput("values",d),b.durations.length!==b.values.length&&flock.fail("Mismatched durations and values array lengths for flock.ugen.sequencer: "+fluid.prettyPrintJSON(d.options.ugenDef)),flock.onMulAddInputChanged(d)},d.init=function(){d.onInputChanged()},d.init(),d},flock.ugen.sequencer.failOnMissingInput=function(a,b){var c=b.inputs[a];c&&flock.isIterable(c)||flock.fail("No "+a+" array input was specified for flock.ugen.sequencer: "+fluid.prettyPrintJSON(b.options.ugenDef))},flock.ugen.sequencer.calcDurationsSamps=function(a,b){b.samplesRemaining=Math.floor(a[b.idx]*b.sampleRate)},flock.ugen.sequencer.nextStage=function(a,b,c,d){return flock.ugen.sequencer.calcDurationsSamps(a,d),d.samplesRemaining--,c?0:b[d.idx]},fluid.defaults("flock.ugen.sequencer",{rate:"audio",inputs:{durations:[],values:[],loop:0},ugenOptions:{model:{idx:0,samplesRemaining:0,unscaledValue:0,value:0},resetOnNext:!1,holdLastvalue:!1}})}();var fluid=fluid||require("infusion"),flock=fluid.registerNamespace("flock");!function(){"use strict";flock.ugen.valueChangeTrigger=function(a,b,c){var d=flock.ugen(a,b,c);return d.gen=function(a){var b,c,e,f=d.model,g=d.inputs.source.output,h=d.output;for(b=0,c=0;a>b;b++,c+=f.strides.source)e=g[c],h[b]=e!==f.prevVal?1:0,f.prevVal=e;f.value=f.unscaledValue=e},d.onInputChanged=function(a){d.calculateStrides(),"source"===a&&(d.model.prevVal=null)},d.calculateStrides(),d},fluid.defaults("flock.ugen.valueChangeTrigger",{rate:"control",inputs:{source:0},ugenOptions:{model:{unscaledValue:0,value:0,prevVal:0},strideInputs:["source"]}}),flock.ugen.inputChangeTrigger=function(a,b,c){var d=flock.ugen(a,b,c);return d.gen=function(a){var b,c,e,f,g,h=d.model,i=d.inputs.source.output,j=h.strides.source,k=d.inputs.duration.output,l=h.strides.duration,m=h.prevDur,n=d.output;for(b=c=e=0;a>b;b++,c+=j,e+=l)f=i[c],g=k[e],g!==m&&(h.prevDur=g,h.remainingOpenSamples=f>0?g>0?h.sampleRate*g:1:0),h.remainingOpenSamples>0?(n[b]=f,h.remainingOpenSamples--):n[b]=0;h.value=h.unscaledValue=flock.ugen.lastOutputValue(a,n)},d.onInputChanged=function(a){d.calculateStrides(),"source"===a&&(d.model.prevDur=null)},d.calculateStrides(),d},fluid.defaults("flock.ugen.inputChangeTrigger",{rate:"control",inputs:{source:0,duration:0},ugenOptions:{model:{unscaledValue:0,value:0,prevDuration:0,remainingOpenSamples:0},strideInputs:["source","duration"]}}),flock.ugen.triggerCallback=function(a,b,c){var d=flock.ugen(a,b,c);return d.gen=function(a){var b,c,e,f,g,h=d.model,i=d.options,j=d.output,k=d.inputs,l=h.strides.trigger,m=h.strides.source,n=k.trigger.output,o=k.source.output,p=i.callback,q=p.func,r=p.args,s=p["this"],t=h.lastArgIdx,u=h.prevTrig;for(b=c=e=0;a>b;b++,c+=l,e+=m)f=n[c],g=o[e],f>0&&0>=u&&q&&(r[t]=g,q.apply(s,r)),j[b]=g,u=f;h.prevTrig=u,h.value=h.unscaledValue=g},d.onInputChanged=function(){var a=d.options,b=d.model,c=a.callback,e=c.funcName;if(e)c.func=fluid.getGlobalValue(e);else if(c["this"]&&c.method){if("string"!=typeof c["this"])throw new Error("flock.ugen.triggerCallback doesn't support raw 'this' objects.Use a global key path instead.");c["this"]="string"==typeof c["this"]?fluid.getGlobalValue(c["this"]):c["this"],c.func=fluid.get(c["this"],c.method)}b.lastArgIdx=c.args.length,d.calculateStrides()},d.onInputChanged(),d},fluid.defaults("flock.ugen.triggerCallback",{rate:"audio",inputs:{source:0,trigger:0},ugenOptions:{model:{unscaledValue:0,value:0,funcName:void 0,lastArgIdx:0},callback:{"this":void 0,method:void 0,func:void 0,args:[]},strideInputs:["source","trigger"]}}),flock.ugen.t2a=function(a,b,c){var d=flock.ugen(a,b,c);return d.gen=function(){for(var a,b=d.model,c=d.inputs.source.output[0],e=0|d.inputs.offset.output[0],f=d.output,g=0;g<f.length;g++)f[g]=a=0;c>0&&b.prevTrig<=0&&(f[e]=a=c),b.prevTrig=c,b.value=b.unscaledValue=a},d},fluid.defaults("flock.ugen.t2a",{rate:"audio",inputs:{source:null,offset:0},ugenOptions:{model:{prevTrig:0,unscaledValue:0,value:0}}})}();